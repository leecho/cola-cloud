var app=angular.module("app",["ngAnimate","ngResource","ui.router","ui.bootstrap","ui.validate","pascalprecht.translate","messager","toaster","hc.util","hc.ui","hc.common"]);app.config(["$controllerProvider","$compileProvider","$filterProvider","$provide",function(e,t,s,n){app.controller=e.register,app.directive=t.directive,app.filter=s.register,app.factory=n.factory,app.service=n.service,app.constant=n.constant,app.value=n.value}]).config(["$translateProvider",function(e){e.useStaticFilesLoader({prefix:"asset/l10n/",suffix:".js"}),e.preferredLanguage("zh_CN")}]).factory("responseObserver",["$q","$window",function(e,t){return{responseError:function(s){switch(s.status){case 401:t.location.href="/login"}return e.reject(s)}}}]).config(["$httpProvider",function(e){function t(e,s,n){for(var i in e){var o=e[i],l=s+"."+i;angular.isObject(o)?t(o,l,n):n.push(encodeURIComponent(l)+"="+encodeURIComponent(angular.isUndefined(o)?"":o))}}e.interceptors.push("responseObserver"),e.defaults.transformRequest=function(e){var s=[];for(var n in e){var i=e[n];angular.isObject(i)?t(i,n,s):s.push(encodeURIComponent(n)+"="+encodeURIComponent(angular.isUndefined(i)?"":i))}return s.join("&")},e.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},e.defaults.headers.get={"X-Requested-With":"XMLHttpRequest"}}]),app.run(["$rootScope","$state","$stateParams","$http","Messager",function(e,t,s,n,i){e.$state=t,e.$stateParams=s}]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,s){s.html5Mode(!0),t.otherwise("/index/enterprise/root"),t.when("/index/{mount}",["$state","$match","$rootScope",function(e,t,s){["favorites","recent","recycle","share","changePassword","profile","messages","search"].indexOf(t.mount)>=0?e.go(t.mount,{},{location:!1}):e.go("directory",{mount:t.mount,directory:"root"})}]),t.when("/index/{mount}/{directory}/{file}",["$state","$match","$rootScope",function(e,t,s){s.fid=t.file,["favorites","recent","recycle","share","search"].indexOf(s.context)>=0||("search"==t.mount?e.go("search",{keyword:t.directory}):s.router||e.go("directory",{mount:t.mount,directory:t.directory},{location:!1}))}]),e.state("favorites",{url:"/index/favorites",templateUrl:"asset/tpl/favorites.html",controller:"FavoritesCtrl"}).state("recycle",{url:"/index/recycle",templateUrl:"asset/tpl/recycle.html",controller:"RecycleCtrl"}).state("recent",{url:"/index/recent",templateUrl:"asset/tpl/recent.html",controller:"RecentsCtrl"}).state("share",{url:"/index/share",templateUrl:"asset/tpl/shares.html",controller:"ShareCtrl"}).state("search",{url:"/index/search/{keyword}",templateUrl:"asset/tpl/search.html",controller:"SearchCtrl"}).state("directory",{url:"/index/{mount}/{directory}",templateUrl:"asset/tpl/directory.html",controller:"DirectoryCtrl"}).state("file",{url:"/index/{mount}/{directory}/{file}"}).state("changePassword",{url:"/index/changePassword",templateUrl:"asset/tpl/change_password.html",controller:"ChangePasswordCtrl"}).state("profile",{url:"/index/profile",templateUrl:"asset/tpl/profile.html",controller:"ProfileCtrl"}).state("messages",{url:"/index/messages",templateUrl:"asset/tpl/messages.html",controller:"MessagesCtrl"})}]),app.controller("AppCtrl",["$rootScope","$scope","toaster","FileSystem","Messager","$http","$modal","$location","$state","userData","setting","WebUploader","Dropbox","FileOperation",function(e,t,s,n,i,o,l,a,c,r,d,p,u,g){t.ie9=/msie 9/.test(window.navigator.userAgent.toLowerCase()),t.supportWebkitDirectory="webkitdirectory"in HTMLInputElement.prototype,t.showQueue=!1,e.toaster=s,e.files=[],e.appConfig=d,e.icons=d.icons,e.resourceServerUrl=d.resourceServceUrl+"/",e.staticResourceServerUrl=d.staticResourceServerUrl+"/",p.init(t),u.init(t),g.init(t),e.user=r.user,e.organization=r.organization,e.space=r.space,e.space.quatoPrecent=e.space.used/e.space.quato,e.mounts={my:t.user.id,enterprise:t.organization.id},e.contexts={},e.contexts[t.user.id]="my",e.contexts[t.organization.id]="enterprise",t.user.changePassword&&t.$on("$stateChangeStart",function(e,s,n,i){!0===t.user.changePassword&&"changePassword"!=s.name&&(e.preventDefault(),c.go("changePassword"))}),t.onSearchKeyDown=function(e){13==e.keyCode&&t.search()},t.search=function(e){t.keyword&&c.go("search",{keyword:t.keyword})},t.checkPermission=function(e){return("upload"!=e||"enterprise"!=t.router)&&(!(!t.isAdmin()&&"my"!=t.context)||!!t.current&&(!(t.current.permission&&t.current.permission.length>0)||t.current.permission.indexOf(e)>=0))},t.authorize=function(e,s){if(t.isAdmin()||"my"==t.context)return!0;if("enterprise"==t.router)return"download"==e;if(t.current)return!(i=t.current.permission)||0==i.length||i.indexOf(e)>=0;var n=s?[s]:t.selection;if(!n)return!1;var i=t.permissions,o=n.length;if(!i)return!0;for(var l=0;l<o;l++){var a=i[n[l].id];if(a&&a.indexOf(e)<0)return!1}return!0},e.getContext=function(t){return e.contexts[t]},e.setCurrent=function(t){t?(e.mount=t.mount,e.context=e.contexts[t.mount],e.router=t.id,e.driectoryName=t.name):"my"==e.context?e.driectoryName="个人文档":e.driectoryName="企业文档",e.current=t},e.isAdmin=function(){return["SYS_ADMIN","DOC_ADMIN"].indexOf(e.user.role)>=0},t.$on("$locationChangeSuccess",function(t,s,n){e.fid?e.openFile():e.closeFile()}),e.getExt=function(e){if(e){var t=e.name;if(t)return t.substring(t.lastIndexOf(".")+1,t.length)}},e.getIcon=function(t){var s;if("directory"==t.type)s=Util.isPrivate(t)?e.appConfig.privateFolderIcon:e.appConfig.publicFolderIcon;else{var n=e.getExt(t);if(!n)return;n=n.toLowerCase(),(s=e.icons[n])||(s=e.appConfig.defaultDocIcon)}if(s)return"@"==s.charAt(0)?e.resourceServerUrl+s.substring(1):e.staticResourceServerUrl+s},t.updateUser=function(){o.post("/organization/user/set",{name:t.user.name,mode:t.user.mode,sortField:t.user.sortField,sortDesc:t.user.sortDesc})},t.sortField=t.user.sortField||"name",t.sortFields=["type",t.sortField],t.sortDesc=t.user.sortDesc||!1,t.mode=t.user.mode||"list",t.showTags=!0,t.switchShowTag=function(){t.showTags=!t.showTags},t.switchMode=function(e){t.mode=e||("list"==t.mode?"block":"list"),t.user.mode=t.mode},t.changeSort=function(e){t.sortField==e?t.sortDesc=!t.sortDesc:(t.sortField=e,t.sortDesc=!0),t.sortFields=["type",e],t.user.sortField=t.sortField,t.user.sortDesc=t.sortDesc},t.changeDesc=function(){t.sortDesc=!t.sortDesc,t.user.sortDesc=t.sortDesc},e.started=!0}]),angular.element(document).ready(function(){function e(e,s){$.get("/setting").success(function(e){e.success?(delete e.success,app.value("setting",e),t()):alert("加载系统配置信息失败，请重新刷新页面再试")}).error(function(){alert("加载系统配置信息失败，请重新刷新页面再试")})}function t(){angular.bootstrap(document,["app"]),window.clearInterval(window.preloadInterval)}!function(){$.get("/organization/user/me").success(function(t){t.success?(delete t.success,app.value("userData",t),e()):alert("加载用户信息失败，请重新刷新页面再试")}).error(function(){alert("加载用户信息失败，请重新刷新页面再试")})}()}),app.controller("AuthorizePublicCtrl",["$rootScope","$scope","$http","$modal","$modalInstance","data",function(e,t,s,n,i,o){t.permission=o.permission;var l=e.toaster.wait("正在加载权限...");s.get("/conf/permission").success(function(e){e.success?(t.permissions=e.permissions,l.doSuccess("权限已加载")):l.doError("加载权限列表失败:"+e.message)}).error(function(e,t){l.doError("加载权限列表失败:"+(e.mesage||t))}),t.ok=function(){var n={permission:t.permission,id:o.id};t.saving=!0;var l=e.toaster.wait("正在设置权限");s.post("/fs/permission/set",n).success(function(e){t.saving=!1,e.success?(l.doSuccess("权限已设置"),i.close()):l.doError("权限设置失败:"+e.message)}).error(function(e,s){t.saving=!1,l.doError("权限设置失败:"+(e.message||s))})},t.close=function(){i.dismiss("cancel")}}]),app.controller("AuthorizeCtrl",["$rootScope","$scope","$http","Messager","$modal","$modalInstance","id",function(e,t,s,n,i,o,l){t.permissionMap={},s.get("/conf/permission").success(function(e){if(e.success){t.permissions=e.permissions;for(var s=0;s<t.permissions.length;s++)t.permissionMap[t.permissions[s].id]=t.permissions[s].name}else t.toaster.error("加载权限配置失败："+e.message)}).error(function(e,s){t.toaster.error("加载权限配置失败："+(e.message||s))}),t.select=function(e,s){s.stopPropagation(),t.current!=e?t.current=e:t.current=null},t.condition={},t.changeConditionPermission=function(e){t.condition.permission=e},t.load=function(){t.loading=!0,s.get("/fs/authorize/list",{params:{source:l}}).success(function(e,s,n,i){t.loading=!1,e.success?t.authorizes=e.authorizes:t.toaster.pop("error",e.message)}).error(function(e,s){t.loading=!1,t.toaster.pop("error","加载失败："+s)})},t.count=function(e){if(!t.authorize||0==t.authorize.length)return!1;var s=0;return t.authorize.forEach(function(t){t.type==e&&s++}),s>0},t.addUser=function(){i.open({templateUrl:"asset/tpl/authorize_user.html",controller:"AuthorizeUserCtrl",size:"lg",backdrop:"static",resolve:{permissions:function(){return t.permissions},id:function(){return l}}}).result.then(function(e){t.load()},function(){})},t.addDept=function(){i.open({templateUrl:"asset/tpl/authorize_dept.html",controller:"AuthorizeDeptCtrl",size:"sm",backdrop:"static",resolve:{permissions:function(){return t.permissions},id:function(){return l}}}).result.then(function(e){t.load()},function(){})},t.update=function(e){var n=t.toaster.wait("正在更新权限...");s.post("/fs/authorize/update",{id:e.id,permission:e.permission}).success(function(e){e.success?n.doSuccess("权限已更新"):n.doError("权限更新失败:"+e.message)}).error(function(e,t){n.doError("权限更新失败:"+(e.message||t))})},t.remove=function(e,i){function o(e){var n=t.toaster.wait("正在删除权限...");s.post("/fs/authorize/remove",{id:e.id}).success(function(e){if(e.success){var s=t.authorizes;s.splice(s.indexOf(permission),1),t.current==permission&&(t.current=null),n.doSuccess("权限已删除")}else n.doError("删除权限失败:"+e.message)}).error(function(e,t){n.doError("权限删除失败:"+(result.message||t))})}i.stopPropagation(),n.confirm("提示","确定要删除?").then(function(){o(e)})},t.ok=function(){o.close(result)},t.close=function(){o.dismiss("cancel")},t.load()}]),app.controller("AuthorizeUserCtrl",["$rootScope","$scope","$http","$modal","$modalInstance","permissions","id",function(e,t,s,n,i,o,l){t.loading=!1,t.tree={},t.permissions=o,t.onTreeInit=function(){var e=t.tree.getRoot();t.tree.select(e)},t.clear=function(){t.searching=!1,t.condition=null},t.selected=[],t.selectedIds=[],t.select=function(e){t.selectedIds.indexOf(e.id)>=0||(t.selected.push(e),t.selectedIds.push(e.id))},t.remove=function(e){t.selectedIds.indexOf(e.id)<0||(t.selected.splice(t.selected.indexOf(e),1),t.selectedIds.splice(t.selectedIds.indexOf(e.id),1))},t.search=function(){t.condition&&(t.searching=!0,t.loading=!0,s.get("/organization/user/search",{params:{condition:t.condition}}).success(function(e,s,n,i){t.loading=!1,e.success?t.result=e.users:t.toaster.pop("error","提示",e.message)}).error(function(e,s){t.loading=!1,t.toaster.pop("error","提示","加载失败："+s)}))},t.ok=function(){var e={source:l,targets:Util.Array.copyProperty(t.selected,"id").join(","),permission:t.permission,type:"user"},n=t.toaster.wait("正在添加权限...");t.saving=!0,s.post("/fs/authorize/add",e).success(function(e){t.saving=!1,e.success?(n.doSuccess("权限已添加"),i.close()):n.doError("添加权限失败："+e.message)}).error(function(e,s){t.saving=!1,n.doError("添加权限失败："+(e.message||s))})},t.loadUser=function(e){t.loading=!0,s.get("/organization/user/list",{params:{departmentId:e.id}}).success(function(e,s,n,i){t.loading=!1,e.success?t.users=e.users:t.toaster.pop("error",e.message)}).error(function(e,s){t.loading=!1,t.toaster.pop("error","加载失败："+s)})},t.close=function(){i.dismiss("cancel")}}]),app.controller("AuthorizeDeptCtrl",["$rootScope","$scope","$http","$modal","$modalInstance","permissions","id",function(e,t,s,n,i,o,l){t.loading=!1,t.tree={},t.permissions=o,t.clear=function(){t.searching=!1,t.condition=null},t.selected=[],t.selectedIds=[],t.onSelectionChange=function(e){t.loadDept(e)},t.select=function(e){t.selectedIds.indexOf(e.id)>=0||(t.selected.push(e),t.selectedIds.push(e.id))},t.remove=function(e,s){t.selectedIds.indexOf(e.id)<0||(t.selected.splice(t.selected.indexOf(e),1),t.selectedIds.splice(t.selectedIds.indexOf(e.id),1))},t.search=function(){t.condition&&(t.searching=!0,t.loading=!0,s.get("/organization/department/search",{params:{condition:t.condition}}).success(function(e,s,n,i){t.loading=!1,e.success?t.result=e.departments:t.toaster.pop("error","提示",e.message)}).error(function(e,s){t.loading=!1,t.toaster.pop("error","提示","加载失败："+s)}))},t.loadDept=function(e){t.loading=!0,s.get("/organization/department/list",{params:{id:e.id}}).success(function(e,s,n,i){t.loading=!1,t.depts=e}).error(function(e,s){t.loading=!1,t.toaster.pop("error","加载失败："+s)})},t.ok=function(){var e={source:l,targets:Util.Array.copyProperty(t.selected,"id").join(","),permission:t.permission,type:"dept"},n=t.toaster.wait("正在添加权限...");t.saving=!0,s.post("/fs/authorize/add",e).success(function(e){t.saving=!1,e.success?(n.doSuccess("权限已添加"),i.close()):n.doError("添加权限失败："+e.message)}).error(function(e,s){t.saving=!1,n.doError("添加权限失败："+(e.message||s))})},t.close=function(){i.dismiss("cancel")}}]),app.controller("ChangePasswordCtrl",["$scope","$http",function(e,t){e.check=function(){var t=0;if(e.password.length<1)return t;/\d/.test(e.password)&&t++,/[a-z]/.test(e.password)&&t++,/[A-Z]/.test(e.password)&&t++,/\W/.test(e.password)&&t++,e.strength=t},e.submit=function(){t.post("/organization/user/change/password",{password:e.password,oldPassword:e.oldPassword}).success(function(t){t.success?(e.password=null,e.oldPassword=null,e.confirmPassword=null,e.success=!0,e.cause=null,e.user.changePassword=!1):(e.cause=t.message,e.success=!1)}).error(function(t,s){e.error=t.message||s,e.success=!1})}}]),app.controller("DropboxCtrl",["$scope","$http","data","$modalInstance","Messager",function(e,t,s,n,i){e.files=[];for(var o=0;o<s.files.length;o++)e.files.push(s.files[o]);e.treeConfig={"load-url":"/fs/folder","load-asyn":!0,"open-folder-icon":"fa fa-users","folder-icon":"fa fa-users","leaf-icon":"fa fa-folder"},e.setParam=function(e,t){t.mount=e.mount,t.permission="upload"},e.directory=s.directory,e.directory||(e.directory={router:"my",mount:e.mounts.my,name:"我的文档",fullName:"我的文档"}),e.onChange=function(t){t.id||t.mount!=e.mounts.enterprise?e.allowed=!0:e.allowed=!1},e.remove=function(t){e.files.splice(e.files.indexOf(t),1),0==e.files.length&&n.dismiss("cancel")},e.ok=function(){var t={router:e.directory.id||e.contexts[e.directory.mount],parent:e.directory.id,path:e.directory.name,mount:e.directory.mount};n.close({files:e.files,uploadContext:t})},e.cancel=function(){i.confirm("提示","是否确定放弃上传?").then(function(e){n.dismiss("cancel")},function(){})}}]),app.controller("FavoritesCtrl",["$rootScope","$scope","$http","$state","$location","$modal","Messager","FileSystem",function(e,t,s,n,i,o,l,a){function c(e){116==e.keyCode&&(e.preventDefault(),t.load())}e.context="favorites",t.load=function(){t.loading=!0,s.get("/fs/favorites").success(function(e){t.loading=!1,e.success?t.files=e.files:t.error=e.message}).error(function(e,s){t.error=e.message||s,t.toaster.pop("error",e.message||s),t.loading=!1})},t.$on("$viewContentLoaded",function(){t.load()}),t.open=function(s,o){"directory"==s.type?n.go("directory",{mount:t.getContext(s.mount),directory:s.id}):(e.fid=s.id,i.path("/index/"+t.getContext(s.mount)+"/"+(s.parent||"root")+"/"+s.id),o.stopPropagation())},t.removeFavorite=function(){l.confirm("提示","确定要删除?").then(function(){var s=e.toaster.wait("正在删除...");a.removeFavorite(t.selection).then(function(e){s.doSuccess("已删除"),t.load()},function(e){s.doError("删除失败:"+e)})})},t.isSelectAll=!1,t.selection=[],t.selecteAll=function(){t.isSelectAll=!t.isSelectAll;for(var e=t.files.length,s=0;s<e;s++)t.select(t.files[s],t.isSelectAll)},t.addSelection=function(e){t.selection.push(e),e.selected=!0,t.selection.length==t.files.length&&(t.isSelectAll=!0)},t.removeSelection=function(e){t.selection.splice(t.selection.indexOf(e),1),e.selected=!1,t.isSelectAll=!1},t.clearSelection=function(){t.selection.forEach(function(e){e.selected=!1}),t.selection=[],t.isSelectAll=!1},t.select=function(e,s,n){if(n&&"block"==t.mode&&!n.ctrlKey&&t.clearSelection(),n&&n.stopPropagation(),!e.selected||s!==e.selected)return s=s||!e.selected||!e.selected,!1===s?t.removeSelection(e):t.addSelection(e)},t.onContainerClick=function(){"block"==t.mode&&t.clearSelection()},t.remove=function(s){s||0==(s=t.selection).length&&l.alert("提示","请选择要删除的文件"),e.remove(s,function(){t.reload()})},t.reset=function(){t.selection=[],t.isSelectAll=!1},$(document).on("keydown",function(e){c(e)}),t.$on("$destroy",function(){$(document).unbind("keydown",c)})}]),app.controller("FileDetailCtrl",["$rootScope","$scope","$http","FileSystem","Messager","$location","$modal","$modalInstance","id",function(e,t,s,n,i,o,l,a,c){var r=document.body,d=r.requestFullScreen||r.webkitRequestFullScreen||r.mozRequestFullScreen||r.msRequestFullScreen;t.supportFullScreen=d,t.fullScreen=function(){var e=document.getElementById("file-preview-container");(e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullScreen).call(e),t.hiddenDetail=!0},t.deg=0,t.rotate=function(){t.deg+=90,360==t.deg&&(t.deg=0)},t.addReview=function(e){var n=t.toaster.wait("正在发表评论");s.post("/review/add",{content:e,target:t.file.id}).success(function(e){if(e.success){n.doSuccess("评论发表成功");var s=e.review;s.name=t.user.name,s.avatar=t.user.avatar,t.reviews.push(s)}else n.doError("发表评论失败: "+e.message)}).error(function(e,t){n.doError("发表评论失败: "+(e.message||t))})},t.removeReview=function(e){i.confirm("提示","确定要删除评论?").then(function(){var n=t.toaster.wait("正在删除评论");s.post("/review/delete",{id:e.id}).success(function(s){s.success?(n.doSuccess("评论已删除"),t.reviews.splice(t.reviews.indexOf(e),1)):n.doError("删除评论失败: "+s.message)}).error(function(e,t){n.doError("删除评论失败: "+(e.message||t))})})},t.addFavorite=function(){n.addFavorite(t.file).then(function(){e.toaster.success({title:"已收藏"}),t.favorited=!0},function(){e.toaster.error({title:"收藏失败"})})},t.removeFavorite=function(){n.removeFavorite(t.file).then(function(){e.toaster.success({title:"收藏已取消"}),t.favorited=!1},function(){e.toaster.error({title:"取消收藏失败"})})},t.remove=function(){e.remove(t.file,function(){t.close(!0)})},t.rename=function(){e.rename(t.file,function(e,s){t.file.name=s})},t.move=function(){e.move([t.file],t.file.mount,function(e){t.close(!0)})},t.lock=function(){e.lock(t.file,function(e){t.load(c)})},t.unlock=function(){e.unlock(t.file,function(e){t.load(c)})},t.copy=function(){e.copy([t.file])},t.download=function(s){s||(s=t.file),e.download(s)},t.load=function(e){t.loading=!0;s.get("/fs/get/"+e).success(function(e){t.loading=!1,e.success?(t.file=e.file,t.favorited=e.file.favorited,t.permission=e.permission,t.versions=e.versions,t.versions.push(t.file),t.reviews=e.reviews,t.setCurrent(t.file)):t.error=e.message}).error(function(e,s){t.loading=!1,t.error=s})},t.setVersion=function(n){i.confirm("提示","确定将该版本设置为最新版本?").then(function(){var i=e.toaster.wait("正在设置新版本...");s.post("/fs/version/set",{id:n.id}).success(function(e){e.success?(i.doSuccess("设置最新版本成功"),t.load(e.file.id)):i.doError("设置最新版本失败:"+e.message)}).error(function(e,t){i.doError("设置最新版本失败:"+(e.message||t))})})},t.deleteVersion=function(n){i.confirm("提示","版本删除之后不可恢复，确定删除该版本?").then(function(){var i=e.toaster.wait("正在删除...");s.post("/fs/version/delete",{id:n.id}).success(function(e){e.success?(i.doSuccess("删除版本成功"),t.load(t.file.id)):i.doError("删除版本失败:"+e.message)}).error(function(e,t){i.doError("删除版本失败:"+(e.message||t))})})},t.setCurrent=function(s){t.current=s,t.current.media=t.getMedia(t.current),t.current.icon=e.getIcon(t.current)},t.checkPermission=function(e){return!(!t.isAdmin()&&"my"!=t.context)||(!(t.permission&&t.permission.length>0)||t.permission.indexOf(e)>=0)},t.getMedia=function(e){var s={jpg:"image",bmp:"image",png:"image",gif:"image",pdf:"document",doc:"document",docx:"document",xls:"document",xlsx:"document",ppt:"document",pptx:"document",txt:"document"}[t.getExt(e).toLowerCase()];return s||(s="unknow"),s},t.geImageSrc=function(e){return"/fs/raw/"+e.id},t.getPreviewUrl=function(e){return"/fs/preview/"+e.id},t.close=function(s){a.close(s);var n="/index/"+e.context;["favorites","recent","recycle","share","search"].indexOf(e.context)<0?n+="/"+(t.file.parent||"root"):"search"==e.context&&(n+="/"+e.keyword),o.path(n)},t.load(c)}]),app.controller("FileMoveCtrl",["$rootScope","$scope","Messager","$modalInstance","data",function(e,t,s,n,i){var o=Util.Array.copyProperty(i.files,"id",function(e){return"directory"==e.type});t.isRepeat=!1,t.ok=function(){s.confirm("提示","是否确定要移动?").then(function(){n.close(t.target)})},t.setParam=function(e,t){t.mount=e.mount,t.excludes||(t.excludes=o)},t.setTarget=function(e){var s=i.files[0].parent,n=i.files[0].mount;if(s&&s==e.id?t.isRepeat=!0:s||e.id||n!=e.mount?t.isRepeat=!1:t.isRepeat=!0,!0===t.isRepeat)return t.target=null,void(t.paths=null);var o=[];for(t.target=e,o.push(e.name);e.$parent&&!e.$parent.$root;)e=e.$parent,o.push(e.name);o.reverse(),t.paths=o.join(" / ")},t.close=function(){n.dismiss()}}]),app.controller("FileCopyCtrl",["$rootScope","$scope","Messager","$modalInstance","data",function(e,t,s,n,i){t.ok=function(){s.confirm("提示","是否确定要复制?").then(function(){n.close(t.target)})},t.setParam=function(e,t){t.mount=e.mount},t.setTarget=function(e){var s=[];for(t.target=e,s.push(e.name);e.$parent&&!e.$parent.$root;)e=e.$parent,s.push(e.name);s.reverse(),t.paths=s.join(" / ")},t.close=function(){n.dismiss()}}]),app.controller("FileTagCtrl",["$scope","$http","$modalInstance","Messager","FileSystem","file",function(e,t,s,n,i,o){e.tags=[],e.file=o,o.tags&&(e.tags=o.tags.split(",")),e.remove=function(t){e.tags.splice(e.tags.indexOf(t),1),o.tags=e.tags.join(","),e.save()},e.add=function(){e.tags.indexOf(e.tag)>=0?e.toaster.pop("error","存在相同的标签"):(e.tags.push(e.tag),e.tag=null,o.tags=e.tags.join(","),e.save())},e.save=function(){i.setTag(e.file).then(function(e){})},e.cancel=function(){s.dismiss("cancel")}}]),app.controller("FileSendCtrl",["$scope","$http","files","$modal","$modalInstance","Messager",function(e,t,s,n,i,o){e.files=s,e.remove=function(t){e.files.splice(e.files.indexOf(t),1),0==e.files.length&&i.dismiss("cancel")},e.users=[],e.userIds={},e.addReceiver=function(){n.open({templateUrl:"asset/tpl/common/user_select.html",controller:"SelectUserCtrl",backdrop:"static",resolve:{options:function(){return{multiple:!0}}}}).result.then(function(t){t.forEach(function(t){e.userIds[t.id]||(e.users.push(t),e.userIds[t.id]=t)})})},e.removeReceiver=function(t){e.users.splice(e.users.indexOf(t),1),delete e.userIds[t.id]},e.ok=function(){var s=e.toaster.wait("正在发送");e.sending=!0;var n=Util.Array.copyProperty(e.files,"id").join(","),o=Util.Array.copyProperty(e.users,"id").join(",");t.post("/messager/send/file",{files:n,receivers:o,content:e.content}).success(function(t){e.sending=!1,t.success?(s.doSuccess("发送成功"),i.close()):s.doError("发送失败:"+t.message)}).error(function(e,t){s.doError("发送失败:"+(e.message||t))})},e.cancel=function(){i.dismiss("cancel")}}]),app.controller("DirectoryCtrl",["$rootScope","$scope","$http","$state","$location","$modal","$stateParams","Messager","FileSystem",function(e,t,s,n,i,o,l,a,c){function r(e){angular.element("#fileContextMenu").hide(),angular.element("#containerContextMenu").hide()}function d(e){116==e.keyCode&&(e.preventDefault(),t.reload())}t.ie9&&t.webUploader.addButton({id:"#filePicker",innerHTML:'<i class="glyphicon glyphicon-cloud-upload"></i> 上传文件'});var p=l.directory,u=l.mount;e.mount=e.mounts[u],e.context=u,"root"==p?(p=null,e.router=u):e.router=p,t.$on("$viewContentLoaded",function(){t.load(p)}),t.reload=function(){t.current?t.load(t.current.id):t.load()},t.load=function(s){var n={mount:e.mount};s&&(n.parent=s),t.loading=!0,t.reset(),c.load(e.mount,s).then(function(s){t.files=s.files,t.paths=s.paths,t.permissions=s.permissions,e.setCurrent(s.current),t.loading=!1},function(e){t.error=e,t.toaster.pop("error","加载文件失败",e),t.loading=!1})},t.$on("$fileUploaded",function(s,n){n.current&&(t.current&&n.parent==t.current.id?t.reload():t.current||n.mount!=e.mount||t.reload())}),t.$on("$currentFolderReload",function(e,s){t.reload()}),t.open=function(t,s){"directory"==t.type?n.go("directory",{mount:e.context,directory:t.id}):(e.fid=t.id,i.path("/index/"+e.context+"/"+(t.parent||"root")+"/"+t.id),s&&s.stopPropagation())},t.isFavorited=function(e){return!!t.favorites&&t.favorites.indexOf(e.id)>=0},t.addFavorite=function(t,s){s.stopPropagation(),c.addFavorite(t).then(function(){e.toaster.success({title:"已收藏"}),t.favorited=!0},function(){e.toaster.error({title:"收藏失败"})})},t.removeFavorite=function(t,s){s.stopPropagation(),c.removeFavorite(t).then(function(){e.toaster.success({title:"收藏已取消"}),t.favorited=null},function(){e.toaster.error({title:"取消收藏失败"})})},t.authorizeSetPermissions=function(e){if(t.isAdmin()&&c.isDirectory(e)&&c.isRoot(e)&&"my"!=t.context)return!0},t.isNolocked=function(e){return 0==t.lockedSelectionCount},t.authorizeUnlock=function(e){if(!1===t.hasPermission("lock"))return!1;for(var s=t.selection,n=0;n<s.length;n++)if(!0!==(e=s[n]).locked||e.lockedBy&&e.lockedBy.id==t.user.id)return!1;return!0},t.isSelectAll=!1,t.selection=[],t.lockedSelectionCount=0,t.selecteAll=function(){t.isSelectAll=!t.isSelectAll;for(var e=t.files.length,s=0;s<e;s++)t.select(t.files[s],t.isSelectAll)},t.addSelection=function(e){t.selection.push(e),e.selected=!0,!0===e.locked&&t.lockedSelectionCount++,t.selection.length==t.files.length&&(t.isSelectAll=!0)},t.removeSelection=function(e){t.selection.splice(t.selection.indexOf(e),1),e.selected=!1,!0===e.locked&&t.lockedSelectionCount++,t.isSelectAll=!1},t.clearSelection=function(){t.selection.forEach(function(e){e.selected=!1}),t.selection=[],t.isSelectAll=!1},t.select=function(e,s,n){if(n&&"block"==t.mode&&!n.ctrlKey&&t.clearSelection(),n&&n.stopPropagation(),!e.selected||s!==e.selected)return $(".app-ctrl").scrollTop(0),s=s||!e.selected||!e.selected,!1===s?t.removeSelection(e):t.addSelection(e)},t.onContainerClick=function(){"block"==t.mode&&t.clearSelection()},t.filterTag=function(e,s){t.condition=e,s.stopPropagation()},t.download=function(s){s||(s=t.selection),e.download(s)},t.remove=function(s){s||0==(s=t.selection).length&&a.alert("提示","请选择要删除的文件"),e.remove(s,function(){t.reload()})},t.lock=function(s){s||(s=t.selection[0])||a.alert("提示","请选择要锁定的文件"),e.lock(s,function(){t.reload()})},t.unlock=function(s){s||(s=t.selection[0])||a.alert("提示","请选择要解锁的文件"),e.unlock(s,function(){t.reload()})},t.rename=function(s){s||(s=t.selection[0]),s||a.alert("提示","请选择要重命名的文件"),e.rename(s,function(){t.reload()})},t.share=function(e){e=e||t.selection[0];modalInstance=o.open({templateUrl:"asset/tpl/share.html",controller:"FileShareCtrl",backdrop:"static",resolve:{id:function(){return e.id}}})},t.showAuthorizer=function(e){e=e||t.selection[0];var s;s=c.isPrivate(e)?{templateUrl:"asset/tpl/authorize.html",controller:"AuthorizeCtrl",backdrop:"static",resolve:{id:function(){return e.id}}}:{templateUrl:"asset/tpl/authorize_public.html",controller:"AuthorizePublicCtrl",backdrop:"static",resolve:{data:function(){return{id:e.id,permission:e.permission}}}},modalInstance=o.open(s),modalInstance.result.then(function(e){t.reload()})},t.move=function(){e.move(t.selection,t.mount,function(e){t.reload()})},t.copy=function(){e.copy(t.selection,t.mount,function(e){t.reload()})},t.createDirectory=function(){o.open({templateUrl:"asset/tpl/directory_form.html",controller:"DirectoryFormCtrl",backdrop:"static"}).result.then(function(s){var n={mount:e.mount};t.current&&(n.parent=t.current.id),n.name=s.name,n.accessiblity=s.type;var i=t.toaster.wait({title:"正在创建文件夹"});c.createDirectory(n).then(function(){i.doSuccess({type:"success",title:"创建文件夹成功"}),t.reload()},function(e){i.doError({type:"error",title:"创建文件夹失败："+e})})})},t.showContextMenu=function(e,s){var n=angular.element("#fileContextMenu"),i=angular.element(window.document);t.selected=e,t.select(e,!0,s);var o=s.pageY,l=s.pageX;o+n.height()>i.height()&&(o-=n.height()),l+n.width()>i.width()&&(l-=n.width()),n.css({top:o,left:l}),n.show(),s.stopPropagation()},t.showContainerContextMenu=function(e){var t=angular.element("#containerContextMenu"),s=angular.element(window.document),n=e.pageY,i=e.pageX;n+t.height()>s.height()&&(n-=t.height()),i+t.width()>s.width()&&(i-=t.width()),t.css({top:n,left:i}),t.show(),e.stopPropagation()},t.reset=function(){t.selection=[],t.isSelectAll=!1,t.lockedSelectionCount=!1},$(document).on("keydown",function(e){d(e)}),$(window).on("click",function(e){r(e)}),t.$on("$destroy",function(){$(window).unbind("click",r),$(document).unbind("keydown",d),e.setCurrent(null)})}]),app.controller("DirectoryFormCtrl",["$rootScope","$scope","$modalInstance",function(e,t,s){t.ok=function(){var e={name:t.name,type:t.type};s.close(e)},t.allowPrivate=function(){return"enterprise"==e.context&&t.isAdmin()&&!e.current},t.close=function(){s.dismiss("cancel")}}]),app.controller("MessagesCtrl",["$scope","$http","$rootScope","$location","$state",function(e,t,s,n,i){e.message||e.$on("$viewContentLoaded",function(){e.load()}),e.load=function(){e.loading=!0,t.get("/messager/list").success(function(t){e.loading=!1,t.success?s.messages=t.messages:e.error="加载消息失败:"+t.message}).error(function(t,s){e.loading=!1,e.error="加载消息失败:"+(t.message||s)})},e.open=function(t,o){"directory"==t.type?i.go("directory",{mount:e.getContext(t.mount),directory:t.id}):(s.fid=t.id,n.path("/index/"+e.getContext(t.mount)+"/"+(t.parent||"root")+"/"+t.id),o.stopPropagation())}}]),app.controller("ProfileCtrl",["$scope","$http",function(e,t){e.save=function(){var s=e.toaster.wait("正在保存");t.post("/organization/user/set",{avatar:e.user.avatar,name:e.user.name,mode:e.user.mode,sortField:e.user.sortField,sortDesc:e.user.sortDesc}).success(function(t){t.success?(e.userSettingForm.$setPristine(),e.userSettingForm.$setUntouched(),s.doSuccess("个人设置已保存")):s.doError("保存失败："+t.message)}).error(function(e,t){s.doError("保存失败："+(e.message||t))})},e.selectAvatar=function(){angular.element("#avatarInput").click()},e.upload=function(){var t=angular.element("#avatarInput")[0].files,s=new FormData;s.append("avatar",t[0]);var n=new XMLHttpRequest;n.onload=function(t){if(e.uploading=!1,200!=n.status)e.result={success:!1,message:"上传失败：请稍候再试："+n.status};else{var s=angular.fromJson(n.response);if(e.result=s,s.success){e.user.avatar=s.avatar;var i=angular.element(".avatar-img");i.attr("src",i.attr("src")+"?_dc="+(new Date).getTime())}else e.message="上传失败："+s.message}e.$apply()},n.onerror=function(t){e.uploading=!1,e.result={success:!1,message:"上传失败：请稍候再试："+n.status}},n.open("POST","/organization/user/upload/avatar"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.uploading=!0,n.send(s)}}]),app.controller("RecentsCtrl",["$rootScope","$scope","$http","$state","$location","$modal","Messager","FileSystem",function(e,t,s,n,i,o,l,a){function c(e){116==e.keyCode&&(e.preventDefault(),t.load())}e.context="recent",t.load=function(){t.loading=!0,s.get("/fs/recents").success(function(e){t.loading=!1,e.success?t.files=e.files:t.error=e.message}).error(function(e,s){t.error=e.message||s,t.toaster.pop("error",e.message||s),t.loading=!1})},t.$on("$viewContentLoaded",function(){t.load()}),t.open=function(s,o){"directory"==s.type?n.go("directory",{mount:t.getContext(s.mount),directory:s.id}):(e.fid=s.id,i.path("/index/"+t.getContext(s.mount)+"/"+(s.parent||"root")+"/"+s.id),o.stopPropagation())},t.removeRecent=function(){l.confirm("提示","确定要删除?").then(function(){var n=e.toaster.wait("正在删除..."),i=Util.Array.copyProperty(t.selection,"id").join(",");s.post("/recent/remove",{hcoId:i}).success(function(e){e.success?(n.doSuccess("已删除"),t.load()):n.doError("删除失败:"+e.message)}).error(function(e,t){n.doError("删除失败:"+e.message||t)})})},t.clear=function(){l.confirm("提示","确定要清除所有记录?").then(function(){var n=e.toaster.wait("正在清除...");s.post("/recent/clear").success(function(e){e.success?(n.doSuccess("已清除"),t.load()):n.doError("清除失败:"+e.message)}).error(function(e,t){n.doError("清除失败:"+e.message||t)})})},t.isSelectAll=!1,t.selection=[],t.selecteAll=function(){t.isSelectAll=!t.isSelectAll;for(var e=t.files.length,s=0;s<e;s++)t.select(t.files[s],t.isSelectAll)},t.addSelection=function(e){t.selection.push(e),e.selected=!0,t.selection.length==t.files.length&&(t.isSelectAll=!0)},t.removeSelection=function(e){t.selection.splice(t.selection.indexOf(e),1),e.selected=!1,t.isSelectAll=!1},t.clearSelection=function(){t.selection.forEach(function(e){e.selected=!1}),t.selection=[],t.isSelectAll=!1},t.select=function(e,s,n){n&&"block"==t.mode&&!n.ctrlKey&&t.clearSelection(),n&&($(".app-ctrl").scrollTop(0),n.stopPropagation()),e.selected&&s===e.selected||(!1===(s=s||!e.selected||!e.selected)?t.removeSelection(e):t.addSelection(e))},t.onContainerClick=function(){"block"==t.mode&&t.clearSelection()},t.remove=function(s){s||0==(s=t.selection).length&&l.alert("提示","请选择要删除的文件"),e.remove(s,function(){t.reload()})},t.reset=function(){t.selection=[],t.isSelectAll=!1},$(document).on("keydown",function(e){c(e)}),t.$on("$destroy",function(){$(document).unbind("keydown",c)})}]),app.controller("RecycleCtrl",["$rootScope","$scope","$http","$state","$location","$modal","Messager","FileSystem",function(e,t,s,n,i,o,l,a){function c(e){116==e.keyCode&&(e.preventDefault(),t.load())}e.context="recycle",t.load=function(){t.reset(),t.loading=!0,s.get("/fs/recycle").success(function(e){t.loading=!1,e.success?t.files=e.files:t.error=e.message}).error(function(e,s){t.error=e.message||s,t.toaster.pop("error",e.message||s),t.loading=!1})},t.$on("$viewContentLoaded",function(){t.load()}),t.sortField="name",t.sortFields=["type","name"],t.sortDesc=!1,t.changeSort=function(e){t.sortField==e?t.sortDesc=!t.sortDesc:(t.sortField=e,t.sortDesc=!0),t.sortFields=["type",e]},t.changeDesc=function(){t.sortDesc=!t.sortDesc},t.revert=function(){l.confirm("提示","确定要恢复?").then(function(){var n=e.toaster.wait("正在恢复..."),i=Util.Array.copyProperty(t.selection,"id").join(",");s.post("/recycle/revert",{id:i}).success(function(e){e.success?(n.doSuccess("文件已恢复"),t.load()):n.doError("恢复失败:"+e.message)}).error(function(e,t){n.doError("恢复失败:"+(e.message||t))})})},t.destroy=function(){l.confirm("提示","确定要彻底删除?").then(function(){var n=Util.Array.copyProperty(t.selection,"id").join(","),i=e.toaster.wait("正在删除...");s.post("/recycle/delete",{id:n}).success(function(e){e.success?(i.doSuccess("文件已彻底删除"),t.load()):i.doError("删除失败:"+e.message)}).error(function(e,t){i.doError("删除失败:"+(e.message||t))})})},t.clear=function(){l.confirm("提示","确定要清空回收站?").then(function(){var n=e.toaster.wait("正在清空...");s.post("/recycle/clear").success(function(e){e.success?(n.doSuccess("回收站已清空"),t.load()):n.doError("清空回收站失败:"+e.message)}).error(function(e,t){n.doError("清空回收站失败:"+(e.message||t))})})},t.isSelectAll=!1,t.selection=[],t.selecteAll=function(){t.isSelectAll=!t.isSelectAll;for(var e=t.files.length,s=0;s<e;s++)t.select(t.files[s],t.isSelectAll)},t.addSelection=function(e){t.selection.push(e),e.selected=!0,t.selection.length==t.files.length&&(t.isSelectAll=!0)},t.removeSelection=function(e){t.selection.splice(t.selection.indexOf(e),1),e.selected=!1,t.isSelectAll=!1},t.clearSelection=function(){t.selection.forEach(function(e){e.selected=!1}),t.selection=[],t.isSelectAll=!1},t.select=function(e,s,n){n&&"block"==t.mode&&!n.ctrlKey&&t.clearSelection(),n&&n.stopPropagation(),e.selected&&s===e.selected||(!1===(s=s||!e.selected||!e.selected)?t.removeSelection(e):t.addSelection(e))},t.onContainerClick=function(){"block"==t.mode&&t.clearSelection()},t.remove=function(s){s||0==(s=t.selection).length&&l.alert("提示","请选择要删除的文件"),e.remove(s,function(){t.reload()})},t.reset=function(){t.selection=[],t.isSelectAll=!1},$(document).unbind("keydown",c),$(document).keydown(function(e){c(e)}),t.$on("$destroy",function(){$(document).unbind("keydown",c)})}]),app.controller("SearchCtrl",["$rootScope","$scope","$http","$state","$stateParams","$location","$modal","Messager","FileSystem",function(e,t,s,n,i,o,l,a,c){function r(e){116==e.keyCode&&(e.preventDefault(),t.load())}e.context="search",t.keyword=i.keyword,e.keyword=t.keyword,t.load=function(){t.loading=!0,t.result=[],s.get("/fs/search",{params:t.buildParam()}).success(function(e){t.loading=!1,e.success?(t.result=e.result,t.pagination.pages=Math.ceil(e.result.total/t.pagination.size)):t.error=e.message}).error(function(e,s){t.error=e.message||s,t.toaster.pop("error",e.message||s),t.loading=!1})},t.$on("$viewContentLoaded",function(){t.load()}),t.reload=function(){t.pagination.page=1,t.load()},t.loadPage=function(e){t.pagination.page=e,t.load()},t.result={rows:[]},t.pagination={size:20,page:1,pages:0},t.onPageChange=function(){t.pagination.page>t.pagination.pages||t.reload()},t.buildParam=function(){return{size:t.pagination.size,page:t.pagination.page,keyword:t.keyword}},t.open=function(s,i){"directory"==s.type?n.go("directory",{mount:t.getContext(s.mount),directory:s.id}):(e.fid=s.id,o.path("/index/"+t.getContext(s.mount)+"/"+(s.parent||"root")+"/"+s.id),i.stopPropagation())},t.isSelectAll=!1,t.selection=[],t.selecteAll=function(){t.isSelectAll=!t.isSelectAll;for(var e=t.files.length,s=0;s<e;s++)t.select(t.files[s],t.isSelectAll)},t.addSelection=function(e){t.selection.push(e),e.selected=!0,t.selection.length==t.files.length&&(t.isSelectAll=!0)},t.removeSelection=function(e){t.selection.splice(t.selection.indexOf(e),1),e.selected=!1,t.isSelectAll=!1},t.clearSelection=function(){t.selection.forEach(function(e){e.selected=!1}),t.selection=[],t.isSelectAll=!1},t.select=function(e,s,n){n&&"block"==t.mode&&!n.ctrlKey&&t.clearSelection(),n&&($(".app-ctrl").scrollTop(0),n.stopPropagation()),e.selected&&s===e.selected||(!1===(s=s||!e.selected||!e.selected)?t.removeSelection(e):t.addSelection(e),console.log(t.selection))},t.onContainerClick=function(){"block"==t.mode&&t.clearSelection()},t.download=function(s){s||(s=t.selection),e.download(s)},t.reset=function(){t.selection=[],t.isSelectAll=!1},$(document).bind("keydown.hc",function(e){r(e)}),t.$on("$destroy",function(){$(document).unbind("keydown.hc")})}]),app.controller("ShareCtrl",["$rootScope","$scope","$http","$state","$location","$modal","Messager","FileSystem",function(e,t,s,n,i,o,l,a){function c(e){116==e.keyCode&&(e.preventDefault(),t.load())}e.context="share",t.load=function(){t.loading=!0,s.get("/share").success(function(e){t.loading=!1,e.success?t.shares=e.shares:t.error=e.message}).error(function(e){t.error=e,t.toaster.pop("error","加载分享列表失败:"+e),t.loading=!1})},t.$on("$viewContentLoaded",function(){t.load()}),t.open=function(s,o){"directory"==s.type?n.go("directory",{mount:t.getContext(s.mount),directory:s.id}):(e.fid=s.id,i.path("/index/"+t.getContext(s.mount)+"/"+(s.parent||"root")+"/"+s.id),o.stopPropagation())},t.sortField="name",t.sortFields=["type","name"],t.sortDesc=!1,t.changeSort=function(e){t.sortField==e?t.sortDesc=!t.sortDesc:(t.sortField=e,t.sortDesc=!0),t.sortFields=["type",e]},t.changeDesc=function(){t.sortDesc=!t.sortDesc},t.remove=function(){l.confirm("提示","确定删除选中的共享?").then(function(){var n=e.toaster.wait("正在删除..."),i=Util.Array.copyProperty(t.selection,"shareId").join(",");s.post("/share/delete",{id:i}).success(function(e){e.success?(n.doSuccess("共享已删除"),t.load()):n.doError("删除失败:"+e.message)}).error(function(e,t){n.doError("删除失败:"+(e.message||t))})})},t.isSelectAll=!1,t.selection=[],t.selecteAll=function(){t.isSelectAll=!t.isSelectAll;for(var e=t.shares.length,s=0;s<e;s++)t.select(t.shares[s],t.isSelectAll)},t.addSelection=function(e){t.selection.push(e),e.selected=!0,t.selection.length==t.shares.length&&(t.isSelectAll=!0)},t.removeSelection=function(e){t.selection.splice(t.selection.indexOf(e),1),e.selected=!1,t.isSelectAll=!1},t.clearSelection=function(){t.selection.forEach(function(e){e.selected=!1}),t.selection=[],t.isSelectAll=!1},t.select=function(e,s,n){n&&"block"==t.mode&&!n.ctrlKey&&t.clearSelection(),n&&n.stopPropagation(),e.selected&&s===e.selected||(!1===(s=s||!e.selected||!e.selected)?t.removeSelection(e):t.addSelection(e))},t.onContainerClick=function(){"block"==t.mode&&t.clearSelection()},$(document).on("keydown",function(e){c(e)}),t.$on("$destroy",function(){$(document).unbind("keydown",c)}),t.reset=function(){t.selection=[],t.isSelectAll=!1}}]),app.controller("FileShareCtrl",["$scope","$http","Messager","$modalInstance","id",function(e,t,s,n,i){e.copy=function(){document.getElementById("shareLink").select(),document.execCommand("Copy")&&e.toaster.success("链接已复制")},e.load=function(){var s=e.toaster.wait("正在获取链接...");t.get("/share/get/"+i).success(function(t){t.success?(e.share=t.share,e.link=t.link,e.dueDate=t.share.dueDate,s.doSuccess("获取链接成功")):(s.doError("获取链接失败:"+t.message),n.dismiss())}).error(function(e,t){s.doError("获取链接失败:"+(e.message||t)),n.dismiss()})},e.remove=function(){function i(){e.deleting=!0;var s=e.toaster.wait("正在删除链接...");t.post("/share/delete",{id:e.share.id}).success(function(t){e.deleting=!1,t.success?(s.doSuccess("链接已删除"),n.dismiss()):s.doError("链接删除失败:"+t.message)}).error(function(t,n){e.deleting=!1,s.doError("链接删除失败:"+(t.message||n))})}s.confirm("提示","删除之后不能恢复，确定要删除?").then(function(){i()})},e.update=function(){e.saving=!0;var s=e.toaster.wait("正在更新分享链接...");e.share.dueDate&&(e.share.dueDate=moment(e.share.dueDate).format("YYYY-MM-DD")),t.post("/share/update",e.share).success(function(t){e.saving=!1,t.success?(e.shareForm.$setPristine(),e.shareForm.$setUntouched(),s.doSuccess("分享设置已更新")):s.doError("分享设置更新失败:"+t.message)}).error(function(t,n){e.saving=!1,s.doError("链接删除失败:"+(t.message||n))})},e.close=function(){n.dismiss()},e.load()}]),app.factory("Dropbox",["$rootScope","FileSystem","$modal",function(e,t,s){var n={};return n.init=function(e){function t(e){e.preventDefault(),e.stopImmediatePropagation()}var n=document.getElementById("dropbox"),i=!1;document.addEventListener("mousedown",function(){i=!0}),document.addEventListener("mouseup",function(){i=!1}),document.addEventListener("dragenter",function(t){i||(!0===e.checkPermission("upload")&&e.current?n.innerText="文件拖放到此处上传到当前文件夹":n.innerText="文件拖放到此处上传",n.style.display="block")},!1),n.addEventListener("dragenter",function(e){t(e)}),n.addEventListener("dragover",function(e){t(e)}),n.addEventListener("dragleave",function(e){t(e),n.style.display="none"}),n.addEventListener("drop",function(i){t(i),n.style.display="none";var o=i.dataTransfer.files;o&&o.length>0&&s.open({templateUrl:"asset/tpl/dropbox.html",backdrop:"static",controller:"DropboxCtrl",resolve:{data:function(){return{files:o,directory:e.checkPermission("upload")?e.current:null}}}}).result.then(function(t){for(var s=t.files,n=0;n<s.length;n++){var i=s[n];i.uploadContext=t.uploadContext,e.webUploader.addFiles(i)}},function(){})})},n}]),app.factory("FileOperation",["$rootScope","FileSystem","$modal","Messager","$state",function(e,t,s,n,i){var o={};return o.init=function(o){o.openParent=function(t,s){i.go("directory",{mount:e.getContext(t.mount),directory:t.parent||"root"}),s.stopPropagation()},e.closeFile=function(t){e.fileModal&&(e.fileModal.dismiss("cancel"),e.fileModal=null)},e.sendFile=function(e){angular.isArray(e)||(e=[e]),s.open({templateUrl:"asset/tpl/file_send.html",backdrop:"static",controller:"FileSendCtrl",resolve:{files:function(){return e}}}).result.then(function(e){},function(){})},e.openFile=function(t){var n=s.open({templateUrl:"asset/tpl/file.html",backdrop:"static",controller:"FileDetailCtrl",size:"full",resolve:{id:function(){return e.fid}}});n.result.then(function(e){!0===e&&o.$broadcast("$currentFolderReload",response.file)},function(){}),e.fileModal=n,e.fid=null},e.remove=function(e,s,i){n.confirm("提示","文件删除之后可以在回收站内还原，是否确定删除选中的文件?").then(function(){var n=o.toaster.wait({title:"正在删除文件..."});t.remove(e).then(function(e){n.doSuccess("删除文件成功"),angular.isFunction(s)&&s(e)},function(e){n.doError("删除文件失败:"+e),angular.isFunction(i)&&i(e)})})},e.lock=function(e,s,i){n.confirm("提示","锁定文件后只能本人进行解锁，确定要锁定?").then(function(){var n=o.toaster.wait({title:"正在锁定..."});t.lock(e).then(function(e){n.doSuccess("文件已锁定"),angular.isFunction(s)&&s(e)},function(e){n.doError("锁定文件失败:"+e),angular.isFunction(i)&&i(e)})})},e.unlock=function(e,s,i){n.confirm("提示","确定要解锁文件?").then(function(){var n=o.toaster.wait({title:"正在解锁..."});t.unlock(e).then(function(e){n.doSuccess("文件已解锁"),angular.isFunction(s)&&s(e)},function(e){n.doError("解锁文件失败:"+e),angular.isFunction(i)&&i(e)})})},e.setTag=function(e,t,n){s.open({templateUrl:"asset/tpl/tags.html",controller:"FileTagCtrl",backdrop:"static",resolve:{file:function(){return e}}}).result.then(function(e){angular.isFunction(t)&&t(e)})},e.rename=function(e,s,i){n.prompt("重命名","",e.name).then(function(n){var l=o.toaster.wait({title:"正在重命名..."});t.rename(e.id,n).then(function(e){l.doSuccess({title:"重命名成功"}),angular.isFunction(s)&&s(e,n)},function(e){l.doError({title:"重命名失败",body:e}),angular.isFunction(i)&&i(e)})})},e.move=function(e,n,i,l){s.open({templateUrl:"asset/tpl/move.html",controller:"FileMoveCtrl",backdrop:"static",resolve:{data:function(){return{files:e,mount:n}}}}).result.then(function(s){var n=o.toaster.wait({title:"正在移动..."});t.move(e,s.id,s.mount).then(function(e){n.doSuccess({title:"移动成功"}),angular.isFunction(i)&&i(e)},function(e){n.doError({title:"移动失败",body:e}),angular.isFunction(l)&&l(e)})})},e.copy=function(e,n){s.open({templateUrl:"asset/tpl/copy.html",controller:"FileCopyCtrl",backdrop:"static",resolve:{data:function(){return{files:e,mount:n}}}}).result.then(function(s){var n=o.toaster.wait({title:"正在复制..."});t.copy(e,s.id,s.mount).then(function(e){n.doSuccess({title:"复制成功"}),angular.isFunction(success)&&success(e)},function(e){n.doError({title:"复制失败",body:e}),angular.isFunction(error)&&error(e)})})},e.download=function(e){var t=e.id;angular.isArray(e)&&(t=Util.Array.copyProperty(e,"id").join(",")),o.downloadURL="/fs/download?id="+t},e.uploadNewVersion=function(t){e.master=t.master||t.id,Util.openSelectFileDialog("#uploadFile")}},o}]),app.factory("FileSystem",["$http","$q",function(e,t){var s={};return s.isPrivate=function(e){return"private"==e.accessiblity},s.isDirectory=function(e){return!!e&&"directory"==e.type},s.isRoot=function(e){return!e.root||e.root==e.id},s.download=function(s){var n=t.defer(),i=s.id;return angular.isArray(s)&&(i=Util.Array.copyProperty(s,"id").join(",")),e.get("/fs/download",{params:{id:i}}).success(function(){n.resolve()}),n.promise},s.createDirectory=function(s){var n=t.defer();return e.post("/fs/createDirectory",s).success(function(e){e.success?n.resolve(e):n.reject(e.message)}).error(function(e,t){n.reject(t)}),n.promise},s.load=function(s,n){var i=t.defer();return e.get("/fs/load/"+s+(n?"/"+n:"")).success(function(e){e.success?i.resolve(e):i.reject(e.message)}).error(function(e,t){i.reject(t)}),i.promise},s.addFavorite=function(s){var n=t.defer();return e.post("/favorite/add",{hcoId:s.id}).success(function(e){e.success?n.resolve(e):n.reject(e.message)}).error(function(e,t){n.reject(t)}),n.promise},s.removeFavorite=function(s){var n=t.defer(),i=s.id;return angular.isArray(s)&&(i=Util.Array.copyProperty(s,"id").join(",")),e.post("/favorite/remove",{hcoId:i}).success(function(e){e.success?n.resolve(e):n.reject(e.message)}).error(function(e,t){n.reject(t)}),n.promise},s.setTag=function(s){var n=t.defer();return e.post("/fs/tag",{id:s.id,tags:s.tags}).success(function(e){e.success?n.resolve(e):n.reject(e.message)}).error(function(e,t){n.reject(t)}),n.promise},s.copy=function(s,n,i){var o=t.defer();return s=angular.isArray(s)?Util.Array.copyProperty(s,"id").join(","):s.id,e.post("/fs/copy",{source:s,target:n,mount:i}).success(function(e){e.success?o.resolve(e):o.reject(e.message)}).error(function(e,t){o.reject(t)}),o.promise},s.move=function(s,n,i){var o=t.defer();return s=angular.isArray(s)?Util.Array.copyProperty(s,"id").join(","):s.id,e.post("/fs/move",{source:s,target:n,mount:i}).success(function(e){e.success?o.resolve(e):o.reject(e.message)}).error(function(e,t){o.reject(t)}),o.promise},s.remove=function(s){var n=t.defer(),i=s.id;return angular.isArray(s)&&(i=Util.Array.copyProperty(s,"id").join(",")),e.post("/fs/remove",{id:i}).success(function(e){e.success?n.resolve(e):n.reject(e.message)}).error(function(e,t){n.reject(e.message||t)}),n.promise},s.lock=function(s){var n=t.defer();return e.post("/fs/lock",{id:s.id}).success(function(e){e.success?n.resolve(e):n.reject(e.message)}).error(function(e,t){n.reject(e.message||t)}),n.promise},s.unlock=function(s){var n=t.defer();return e.post("/fs/unlock",{id:s.id}).success(function(e){e.success?n.resolve(e):n.reject(e.message)}).error(function(e,t){n.reject(e.message||t)}),n.promise},s.rename=function(s,n){var i=t.defer();return e.post("/fs/rename",{id:s,name:n}).success(function(e){e.success?i.resolve(e):i.reject(e.message)}).error(function(e,t){i.reject(t)}),i.promise},s.verify=function(s){var n=t.defer();return e.post("/fs/upload/verify",{md5:s.md5,directory:s.directory,name:s.name,path:s.path,ext:s.ext,mount:s.mount,parent:s.parent,size:s.size,master:s.master}).success(function(e){e.success?n.resolve(e):n.reject(e)}).error(function(e,t){n.reject(e)}),n.promise},s.checkChunk=function(e){var s=t.defer();if(e.file.uploaded){var n=e.file.uploaded[e.chunk];n&&n==e.end-e.start?s.resolve():s.reject()}else s.reject();return s.promise},s}]),app.factory("SocketIO",["$rootScope","FileSystem","$modal",function(e,t,s){var n={};return n.init=function(e){if(window.WebSocket){var t=new WebSocket("ws://localhost:8080/socket.io");t.onopen=function(){},t.onclose=function(){},t.onerror=function(){}}},n}]),app.factory("WebUploader",["$rootScope","FileSystem",function(e,t){var s={};return s.init=function(s){function n(){s.uploadStats=s.webUploader.getStats()}if(e.onUploadFileChange=function(){var e=document.getElementById("uploadFile").files;if(e)for(var t=e.length,n=0;n<t;n++){var i=e[n],o=WebUploader.guid();s.webUploader.addFile(i,o)}},window.WebUploader){WebUploader.Uploader.register({"before-send-file":"beforeSendFile","before-send":"beforeSend","after-send-file":"afterSendFile"},{beforeSendFile:function(e){var n=WebUploader.Deferred();return e.setStatus("md5","正在校验文件"),s.webUploader.md5File(e,0,10485760).progress(function(t){e.md5Percentage=t}).then(function(s){e.md5=s,t.verify(e).then(function(t){!0===t.uploadedByMd5?(e.uploadProgress=1,n.reject(),e.setStatus("success","极速上传成功")):(e.uploaded=t.uploaded,n.resolve())},function(t){e.setStatus("error",t.message),n.reject()})}),n.promise()},beforeSend:function(e){var s=WebUploader.Deferred();return t.checkChunk(e).then(function(e){s.reject()},function(e){s.resolve()}),s.promise()}});var i={swf:"asset/swf/Uploader.swf",server:(e.appConfig.uploadServerUrl?"http://"+e.appConfig.uploadServerUrl:"")+"/fs/upload",auto:!0,duplicate:!1,compress:!1,chunked:!0,chunkSize:1024*e.appConfig.partSize*1024,withCredentials:!0},o=WebUploader.create(i);o.on("uploadBeforeSend",function(e,t,s){t.md5=e.file.md5,t.parent=e.file.parent,t.mount=e.file.mount,t.directory=e.file.directory,t.master=e.file.master,s["X-Requested-With"]="XMLHttpRequest"}),o.on("fileQueued",function(t){if(t.source.source.uploadContext){var n=t.source.source.uploadContext;t.mount=n.mount,t.parent=n.parent,t.path=n.path,t.router=n.router}else t.mount=e.mount,e.current?(t.parent=e.current.id,t.path=e.current.name):"enterprise"==e.router?t.path="企业文档":t.path="我的文档",t.router=e.router,e.master&&(t.master=e.master,delete e.master),t.webkitRelativePath&&(t.directory=t.webkitRelativePath.replace(t.name,""));t.icon=s.getIcon(t),t.on("statuschange",function(e){t.status=e}),e.files.push(t),s.showQueue=!0}),o.on("fileDequeued",function(t){var s=e.files;s.splice(s.indexOf(t),1)}),o.on("uploadProgress",function(e,t){e.uploadPercentage=t.toFixed(2),e.setStatus("progress","正在上传："+100*e.uploadPercentage+"%"),s.$apply()}),o.on("uploadSuccess",function(t,i){n(),!0===i.success?(s.$broadcast("$fileUploaded",i.file),t.setStatus("success","上传成功")):t.setStatus("error","上传失败"),e.$apply()}),o.on("uploadError",function(t,s){n(),t.setStatus("error",s?"系统异常，上传失败":t.statusText),s&&e.$apply()}),o.on("uploadStart",function(e){e.setStatus("progress","正在上传"),n()}),o.on("uploadComplete",function(e){n(),0==s.uploadStats.progressNum&&(s.showQueue=!1)}),s.webUploader=o}else console.error("没有找到WebUploader组件")},s}]),angular.module("app").run(["$templateCache",function(e){"use strict";e.put("asset/tpl/authorize_dept.html",'<div class=m-c><div class=modal-header><div class="pull-right col-md-6 no-padder"><div class=input-group><input class=form-control ng-model=condition placeholder=搜索:名称/拼音><div class=input-group-btn><button type=button class="btn btn-default" ng-show=condition ng-click=clear();><i class="glyphicon glyphicon-remove"></i></button> <button type=button class="btn btn-default" ng-click=search();><i class="glyphicon glyphicon-search"></i></button></div></div></div><h4 class=modal-title style="line-height: 34px"><i class="fa fa-users"></i> 添加部门</h4></div><div class="modal-body no-padder"><div class=permission-user-body ng-show=!searching><div class="col-sm-6 permission-user-part b-r wrapper-sm"><hc-tree tree-control=tree load-asyn=true open-folder-icon="fa fa-users" folder-icon="fa fa-users" leaf-icon="fa fa-users" on-node-dbl-click=select(node); on-selection-change=onSelectionChange(selection); load-url=/organization/department/list></hc-tree></div><div class="col-sm-6 permission-user-part wrapper-sm"><div class="wrapper-xl text-center" ng-show=loading><img src=asset/img/loading.gif><p class=m-t-sm>正在加载</p></div><div ng-repeat="dept in depts" class="wrapper-xs hover-bg" ng-show=!loading ng-click=select(dept);><i class="fa fa-users"></i> <span class=m-l-sm>{{dept.name}}</span></div></div></div><div class="permission-user-body wrapper-sm" ng-show=searching><div class="col-md-4 wrapper-sm hover-bg" ng-repeat="dept in result" ng-click=select(dept);><i class="fa fa-users" style=font-size:20px></i> <span>{{dept.name}}</span></div><div class=col-sm-12 ng-show="result.length == 0"><div class="wrapper-xs text-center"><img ng-src="{{\'asset/img/user_empty.png\' | resource}}"><p class=m-t-sm>没有搜索到部门</p></div></div><div class="col-sm-12 permission-user-part" ng-show=loading><div class="wrapper-xl text-center"><img ng-src="{{\'asset/img/loading.gif\' | resource}}"><p class=m-t-sm>正在加载</p></div></div></div><div class="wrapper-sm b-t row m-l-none m-r-none" ng-hide="selected.length == 0"><div class="permission-dept-selected wrapper-sm text-left col-sm-3 hover-bg text-ellipsis" ng-repeat="dept in selected" ng-click=remove(dept)><button type=button class=close ng-click=remove(dept)><span aria-hidden=true>×</span></button> <i class="fa fa-users"></i> {{dept.name}}</div></div></div><div class=modal-footer><form class="form-inline inline"><div class=input-group><span class=input-group-addon>权限</span><select class="form-control wrapper-xs" ng-model=permission><option ng-repeat="permission in permissions" value={{permission.id}}>{{permission.name}}</option></select></div></form><button type=button class="btn btn-primary" ng-click=ok() style="margin-left: 5px" ng-disabled="selected.length == 0 || !permission || saving"><span ng-show=!saving>提交</span> <span ng-show=saving>正在提交</span></button> <button type=button class="btn btn-default" ng-click=close()>取消</button></div></div>'),e.put("asset/tpl/authorize_public.html",'<div class=m-c><div class=modal-header><h4 class=modal-title>设置权限</h4></div><div class="modal-body wrapper-lg"><div class=row><div class=col-sm-12><form name=permissionSetForm class="form-horizontal form-validation"><div class=form-group><label class="col-sm-3 control-label">选择权限：</label><div class=col-sm-9><select class="form-control wrapper-xs" ng-model=permission><option value="">所有权限</option><option ng-repeat="permission in permissions" value={{permission.id}} ng-selected="permission.id == permission">{{permission.name}}</option></select></div><div class=col-sm-12><div class="alert alert-info m-b-none m-t-sm">该文件夹所有成员可见，如果没有设置权限则全员可见</div></div></div></form></div></div></div><div class=modal-footer style="text-align: right"><button type=button class="btn btn-primary" ng-click=ok() style="margin-left: 5px" ng-disabled="!permissionSetForm.$dirty || saving"><span ng-show=!saving>提交</span> <span ng-show=saving>正在提交</span></button> <button type=button class="btn btn-default" ng-click=close()>取消</button></div></div>'),e.put("asset/tpl/authorize_user.html",'<div class=m-c><div class=modal-header><div class="pull-right col-md-6 no-padder"><div class=input-group><input class=form-control ng-model=condition placeholder=搜索:用户名/姓名/拼音><div class=input-group-btn><button type=button class="btn btn-default" ng-show=condition ng-click=clear();><i class="glyphicon glyphicon-remove"></i></button> <button type=button class="btn btn-default" ng-click=search();><i class="glyphicon glyphicon-search"></i></button></div></div></div><h4 class=modal-title style="line-height: 34px"><i class="fa fa-user"></i> 添加用户</h4></div><div class="modal-body no-padder"><div class=permission-user-body ng-show=!searching><div class="col-sm-6 permission-user-part b-r wrapper-sm"><hc-tree tree-control=tree load-asyn=true on-init=onTreeInit() open-folder-icon="fa fa-users" folder-icon="fa fa-users" leaf-icon="fa fa-users" on-selection-change=loadUser(selection); load-url=/organization/department/list></hc-tree></div><div class="col-sm-6 permission-user-part wrapper-sm"><div class="wrapper-xl text-center" ng-show=loading><img src=asset/img/loading.gif><p class=m-t-sm>正在加载</p></div><div ng-repeat="user in users" class="wrapper-xs hover-bg" ng-show=!loading ng-click=select(user);><img ng-src="{{user.avatar | resource}}" class=img-circle style=height:30px alt=...> <span class=m-l-sm style="line-height: 30px">{{user.name}}</span></div></div></div><div class="permission-user-body wrapper-sm" ng-show=searching><div class="col-md-4 wrapper-xs hover-bg" ng-repeat="user in result" ng-click=select(user);><img ng-src="{{user.avatar | resource}}" class="img-circle pull-left" style=height:50px alt=...><div class=inline><span class=m-l-sm style="line-height: 30px">{{user.name}}</span><br><span class=m-l-sm style="line-height: 20px;font-size:12px;color:#bbb">{{user.department.name}}</span></div></div><div class=col-sm-12 ng-show="result.length == 0"><div class="wrapper-xs text-center"><img ng-src="{{\'asset/img/user_empty.png\' | resource}}"><p class=m-t-sm>没有搜索到用户</p></div></div><div class="col-sm-12 permission-user-part" ng-show=loading><div class="wrapper-xl text-center"><img ng-src="{{\'asset/img/loading.gif\' | resource}}"><p class=m-t-sm>正在加载</p></div></div></div><div class="wrapper-sm b-t" ng-hide="selected.length == 0"><div class="permission-user-selected wrapper-sm text-center inline hover-bg" ng-repeat="user in selected"><button type=button class=close ng-click=remove(user)><span aria-hidden=true>×</span></button> <img ng-src="{{user.avatar | resource}}" class=img-circle style=height:35px alt=...><div class="text-ellipsis m-t-xs" style="font-size: 12px">{{user.name}}</div></div></div></div><div class=modal-footer><form class="form-inline inline"><div class=input-group><span class=input-group-addon>权限</span><select class="form-control wrapper-xs" ng-model=permission><option ng-repeat="permission in permissions" value={{permission.id}}>{{permission.name}}</option></select></div></form><button type=button class="btn btn-primary" ng-click=ok() style="margin-left: 5px" ng-disabled="selected.length == 0 || !permission || saving"><span ng-show=!saving>提交</span> <span ng-show=saving>正在提交</span></button> <button type=button class="btn btn-default" ng-click=close()>取消</button></div></div>'),e.put("asset/tpl/authorize.html",'<div class=m-c><div class=modal-header><div class="pull-right col-sm-6 no-padder"><div class=input-group><input class=form-control ng-model=condition.name placeholder=搜索><div class=input-group-btn dropdown is-open=isopen><button type=button class="btn btn-default dropdown-toggle" dropdown-toggle><span ng-if=!condition.permission>全部</span> <span ng-if=condition.permission>{{condition.permission.name}}</span> <span class=caret></span></button><ul class="dropdown-menu dropdown-menu-right"><li ng-click=changeConditionPermission()><a href=#>全部</a></li><li ng-click=changeConditionPermission(permission) ng-repeat="permission in permissions"><a href=#>{{permission.name}}</a></li></ul></div></div></div><h4 class=modal-title style="line-height: 34px"><i class="fa fa-lock"></i> 权限设置</h4></div><div class="modal-body no-padder"><div class="permission-body wrapper-xs" ng-click="current = null"><div class="row m-n"><div class="col-md-4 permission-item wrapper-sm hover-bg" ng-class="{\'active\':current == authorize}" ng-repeat="authorize in authorizes | filter:{name:condition.name,permission:condition.permission.id,type:\'dept\'}" ng-click=select(authorize,$event)><button type=button class=close ng-click=remove(authorize,$event)><span aria-hidden=true>×</span></button> <i class="fa fa-users" class=pull-left style="font-size:36.5px;margin-top: 2px"></i><div class=inline><div class=m-l-sm style="line-height: 25px">{{authorize.name}}</div><div class=m-l-sm style="line-height: 10px;font-size:12px;color:#bbb">{{permissionMap[authorize.permission]}}</div></div></div></div><div class="row m-r-none m-l-none m-t-xs"><div class="col-md-4 permission-item wrapper-sm hover-bg" ng-class="{\'active\':current == authorize}" ng-repeat="authorize in authorizes | filter:{name:condition.name,permission:condition.permission.id,type:\'user\'} " ng-click=select(authorize,$event)><button type=button class=close ng-click=remove(authorize,$event)><span aria-hidden=true>×</span></button> <img ng-src="{{user.avatar | resource}}" class="img-circle pull-left" style=height:40px alt=...><div class=inline><div class=m-l-sm style="line-height: 25px">{{authorize.name}}</div><div class=m-l-sm style="line-height: 10px;font-size:12px;color:#bbb">{{permissionMap[authorize.permission]}}</div></div></div></div><div class="col-sm-12 permission-user-part" ng-show=loading><div class="wrapper-xl text-center"><img ng-src="{{\'asset/img/loading.gif\' | resource}}"><p class=m-t-sm>正在加载</p></div></div><div class=col-sm-12 ng-show="permissions.length == 0"><div class="wrapper-xs text-center"><img ng-src="{{\'asset/img/user_empty.png\' | resource}}" style="height: 200px"><p class=m-t-sm>没有配置权限</p></div></div></div><div class="modal-footer text-left"><div class="col-sm-4 no-padder"><div class=input-group><span class=input-group-addon>权限</span><select class="form-control wrapper-xs" ng-model=current.permission ng-change=update(current) ng-disabled=!current><option ng-repeat="(k,v) in permissionMap" value={{k}} ng-selected="k == current.permission">{{v}}</option></select></div></div><div class=pull-right><button class="btn btn-primary" ng-click=addUser()><i class="fa fa-user"></i> 添加用户</button> <button class="btn btn-primary" ng-click=addDept()><i class="fa fa-users"></i> 添加部门</button> <button class="btn btn-default" ng-click=close()>关闭</button></div></div></div></div>'),e.put("asset/tpl/change_password.html",'<div class=app-ctrl style="padding-top:76px;overflow: hidden" ng-show=!error><div class="b-b app-title-fixed padder"><div class="row wrapper-md bg-light"><div class="col-sm-9 col-xs-9 padder-sm"><span class="m-n directory-header h3"><i class="fa fa-key"></i> 修改密码</span></div></div></div><div class="bg-light wrapper-xl lter app-inner"><form name=form class=w-xl action="" method=post style="margin: 0 auto"><div ng-show=user.changePassword class="alert alert-warning alert-dismissable">您的密码为不安全的密码，系统强制要求修改</div><div ng-show=success class="alert alert-success alert-dismissable">密码修改成功，下次登录使用新密码登录</div><div ng-show=cause class="alert alert-danger alert-dismissable">密码修改失败：{{cause}}</div><div class="input-group-icon m-b"><i class="glyphicon glyphicon-lock input-icon"></i> <input type=password name=oldPassword ng-model=oldPassword class=form-control placeholder=旧密码 required autofocus></div><div class="input-group-icon m-b"><i class="glyphicon glyphicon-lock input-icon"></i> <input type=password name=password ng-model=password class=form-control ng-change=check() ng-model-options="{updateOn: \'blur\'}" placeholder=新密码 required> <span class="help-block m-b-none text-xs text-danger" ng-show="password.length < appConfig.minLengthOfPassword">密码长度不能小于{{appConfig.minLengthOfPassword}}位</span> <span class="help-block m-b-none text-xs text-danger" ng-show="strength < appConfig.passwordStrength"><span ng-if="appConfig.passwordStrength == 2">密码必须为数字和字母组合</span> <span ng-if="appConfig.passwordStrength == 3">密码必须为数字和字母组合，且必须含有大小写字母</span> <span ng-if="appConfig.passwordStrength == 4">密码必须为数字和字母组合，且必须含有大小写字母和特殊字符</span></span></div><div class="input-group-icon m-b"><i class="glyphicon glyphicon-lock input-icon"></i> <input type=password name=confirmPassword ng-model=confirmPassword ng-model-options="{updateOn: \'blur\'}" class=form-control placeholder=密码确认 required> <span ng-show="confirmPassword && confirmPassword != password" class="help-block m-b-none text-xs text-danger">两次密码不一致</span></div><div class=row style="margin-top: 8px"><div class="col-xs-12 col-sm-12 col-md-12"><button class="btn btn-primary btn-block" ng-click=submit() type=button ng-disabled="strength < passwordStrength || form.$invalid || !form.$dirty || confirmPassword != password || password.length < appConfig.minLengthOfPassword">确&nbsp;&nbsp;定</button></div></div></form></div></div>'),e.put("asset/tpl/copy.html",'<div class=m-c><div class=modal-header><h4 class=modal-title>复制文件(夹)</h4></div><div class="modal-body no-padder"><div class=permission-user-body><div class="col-sm-12 permission-user-part b-r wrapper-sm"><div class=wrapper-xs>选择要复制到的位置</div><hc-tree tree-control=tree load-asyn=true leaf-icon="fa fa-folder" on-node-dbl-click=select(node); on-selection-change=setTarget(selection); on-before-load=setParam(node,params); load-url=fs/folder></hc-tree></div></div><div class="wrapper-sm b-t row m-l-none m-r-none" ng-show=target><b>将复制到：</b><span>{{paths}}</span></div></div><div class=modal-footer><button type=button class="btn btn-primary" ng-click=ok() ng-disabled=!target>确定</button> <button type=button class="btn btn-default" ng-click=close()>取消</button></div></div>'),e.put("asset/tpl/directory_form.html",'<div class=m-c><div class=modal-header><h4 class=modal-title>新建文件夹</h4></div><div class="modal-body wrapper-lg"><div class=row><div class=col-sm-12><form name=directoryForm class="form-horizontal form-validation"><div class=form-group><label class="col-sm-2 control-label text-right" style=padding-left:5px;padding-right:5px>名称：</label><div class=col-sm-10><input name=name ng-model=name required class=form-control></div></div><div class="line line-dashed b-b line-xs" ng-show=allowPrivate();></div><div class="form-group m-b-none" ng-show=allowPrivate();><label class="col-sm-2 control-label" style=padding-left:5px;padding-right:5px>是否公开：</label><div class=col-sm-10><label class="checkbox-inline i-checks"><input type=radio name=type value=public ng-model=type><i></i> 公开</label><label class="checkbox-inline i-checks"><input type=radio name=type value=private ng-model=type><i></i> 不公开</label><div ng-show="type ==\'public\'" class="alert alert-info m-b-none m-t-sm" role=alert>对所有成员可见</div><div ng-show="type == \'private\'" class="alert alert-info m-b-none m-t-sm" role=alert>只对已授权的成员可见</div></div></div></form></div></div></div><div class=modal-footer style="text-align: right"><button type=button class="btn btn-primary" ng-click=ok() ng-disabled="(directoryForm.$invalid || !directoryForm.$dirty)">确定</button> <button type=button class="btn btn-default" ng-click=close()>取消</button></div></div>'),e.put("asset/tpl/directory.html",'<div class=app-ctrl style="padding-top:90px;overflow: hidden" ng-show=!error><div class="b-b app-title-fixed padder"><div class="row wrapper-xs b-b bg-light"><div class="col-sm-10 col-xs-10 padder-sm file-path" ui-sref-active=active><a ng-if="context == \'enterprise\'" ui-sref=\'directory({mount:"enterprise",directory:"root"})\'><i class="fa fa-users"></i> <span>企业文档</span> <i ng-if=current class="fa fa-angle-right"></i> </a><a ng-if="context == \'my\'" ui-sref=\'directory({mount:"my",directory:"root"})\'><i class="fa fa-user"></i> <span>我的文档</span> <i ng-if=current class="fa fa-angle-right"></i> </a><a ng-repeat="path in paths" ui-sref=directory({mount:context,directory:path.id})><i class="fa fa-folder"></i> <span>{{path.name}}</span> <i class="fa fa-angle-right"></i> </a><a ng-if=current><i class="fa fa-folder"></i> <span>{{current.name}}</span> </a><span class="text-sm m-l-xs" ng-show="files.length > 0">( <span ng-show="selection.length > 0">{{selection.length}} / </span>{{files.length}} )</span></div><div class="col-sm-2 col-xs-2 text-right" style="padding-left: 0px;padding-right: 5px"><div class=pull-right><button ng-if="mode == \'list\'" class="btn btn-md btn-default" ng-click=switchMode() tooltip=切换到图标视图 tooltip-placement=bottom><i class="fa fa-list"></i></button> <button ng-if="mode == \'block\'" class="btn btn-md btn-default" ng-click=switchMode() tooltip=切换到列表视图 tooltip-placement=bottom><i class="fa fa-th"></i></button> <button ng-if=showTags class="btn btn-md btn-default" ng-click=switchShowTag() tooltip=隐藏标签 tooltip-placement=bottom><i class="fa fa-tags"></i></button> <button ng-if=!showTags class="btn btn-md btn-default" ng-click=switchShowTag() tooltip=显示标签 tooltip-placement=bottom><i class="fa fa-tags"></i></button><div class=btn-group dropdown is-open=openSortmenu><button type=button class="btn btn-md btn-default" ng-click=changeDesc();><i ng-class="{\'fa-long-arrow-down\' : sortDesc,\'fa-long-arrow-up\':!sortDesc}" class=fa></i> <span ng-show="sortField == \'name\'">名称</span> <span ng-show="sortField == \'size\'">大小</span> <span ng-show="sortField == \'creationBy.name\'">创建者</span> <span ng-show="sortField == \'updateDate\'">时间</span></button> <button type=button class="btn btn-md btn-default dropdown-toggle" dropdown-toggle><span class=caret></span></button><ul class=dropdown-menu role=menu style="left: inherit; right: 0px"><li><a href ng-click="changeSort(\'name\')">名称</a></li><li><a href ng-click="changeSort(\'size\')">大小</a></li><li><a href ng-click="changeSort(\'creationBy.name\')">创建者</a></li><li><a href ng-click="changeSort(\'updateDate\')">时间</a></li></ul></div></div></div></div><div class="row wrapper-xs bg-light lter"><div class="col-sm-10 col-xs-10 padder-sm"><div class=btn-group dropdown is-open=isopen ng-show="supportWebkitDirectory && checkPermission(\'upload\') && checkPermission(\'create\')"><button type=button class="btn btn-md btn-primary" onclick="Util.openSelectFileDialog(\'#uploadFile\')"><i class="glyphicon glyphicon-cloud-upload"></i> 上传文件</button> <button type=button class="btn btn-md btn-primary dropdown-toggle" dropdown-toggle><span class=caret></span></button><ul class=dropdown-menu role=menu><li><a href onclick="Util.openSelectFileDialog(\'#uploadFile\')"><i class="fa fa-file"></i> 上传文件</a></li><li><a href onclick="Util.openSelectFileDialog(\'#uploadFile\',true)"><i class="fa fa-folder"></i> 上传文件夹</a></li></ul></div><div id=filePicker class="btn btn-md btn-primary" ng-show="ie9 && checkPermission(\'upload\')"></div><button class="btn btn-md btn-primary" onclick="Util.openSelectFileDialog(\'#uploadFile\')" ng-if="!ie9 " ng-show="!supportWebkitDirectory || (checkPermission(\'upload\') && !checkPermission(\'create\'))"><i class="glyphicon glyphicon-cloud-upload"></i> 上传文件</button> <button class="btn btn-md btn-primary" ng-show="checkPermission(\'create\')" ng-click=createDirectory()><i class="glyphicon glyphicon-plus"></i> 新建文件夹</button> <button class="btn btn-md btn-default" ng-click=showAuthorizer() ng-show="selection.length == 1 && authorizeSetPermissions(selection[0])"><i class="fa fa-lock"></i> 设置权限</button> <button class="btn btn-md btn-default" ng-if="checkPermission(\'download\')" ng-click=download() ng-show="selection.length > 0"><i class="glyphicon glyphicon-cloud-download"></i> 下载</button> <button class="btn btn-md btn-default" ng-show="selection.length > 0" ng-click=sendFile(selection);><i class="fa fa-paper-plane"></i> 发送</button> <button class="btn btn-md btn-default" ng-show="selection.length == 1 && !(selection[0].favorited)" ng-click=addFavorite(selection[0],$event)><i class="fa fa-star"></i> 收藏</button> <button class="btn btn-md btn-default" ng-show="selection.length == 1 && selection[0].favorited" ng-click=removeFavorite(selection[0],$event)><i class="fa fa-star-o"></i> 取消收藏</button> <button class="btn btn-md btn-default" ng-if="checkPermission(\'remove\')" ng-click=remove() ng-show="selection.length > 0 && isNolocked()"><i class="glyphicon glyphicon glyphicon-trash"></i> 删除</button><div class=btn-group dropdown is-open=moreMenuOpen ng-show="selection.length > 0"><button type=button class="btn btn-md btn-default dropdown-toggle" dropdown-toggle><i class="fa fa-angle-down"></i>&nbsp;更多</button><ul class=dropdown-menu role=menu><li ng-if="checkPermission(\'rename\')" ng-click=rename(); ng-show="selection.length == 1"><a href><i class="glyphicon glyphicon-edit"></i>&nbsp;重命名</a></li><li ng-if="checkPermission(\'copy\')" ng-click=copy() ng-show="selection.length > 0"><a href><i class="glyphicon glyphicon-copy"></i>&nbsp;复制</a></li><li ng-if="checkPermission(\'move\')" ng-show="selection.length > 0 && isNolocked()" ng-click=move()><a href><i class="fa fa-share-square-o"></i>&nbsp;移动</a></li><li ng-if="checkPermission(\'lock\')" ng-click=lock() ng-show="selection.length == 1 && selection[0].type == \'file\' && selection[0].locked !== true"><a href><i class="glyphicon glyphicon-lock"></i>&nbsp;锁定</a></li><li ng-if="checkPermission(\'lock\')" ng-click=unlock() ng-show="selection.length == 1 && selection[0].locked === true && selection[0].lockedBy.id == user.id"><a href><i class="fa fa-lock"></i>&nbsp;解锁</a></li><li ng-if="checkPermission(\'tag\')" ng-click=setTag(selection[0]) ng-show="selection.length == 1"><a href><i class="fa fa-tag"></i>&nbsp;标签</a></li><li ng-if="checkPermission(\'upload\')" ng-click=uploadNewVersion(selection[0]) ng-show="selection.length == 1 && selection[0].type == \'file\'  && isNolocked()"><a href><i class="glyphicon glyphicon-cloud-upload"></i>&nbsp;上传新版本</a></li><li class=dropdown-submenu><a tabindex=-1 href=""><i class="fa fa-share-alt"></i>&nbsp;分享 <span class="pull-right m-r-n-md"><i class="fa fa-fw fa-angle-right text"></i></span></a><ul class=dropdown-menu role=menu><li><a href><i class="fa fa-paper-plane"></i>&nbsp;发送给同事</a></li><li ng-show="selection.length == 1" ng-click=share()><a href><i class="fa fa-link"></i>&nbsp;链接分享</a></li></ul></li></ul></div></div><div class="col-sm-2 col-xs-2 padder-sm"><div class="input-group-icon directory-search"><i class="glyphicon glyphicon glyphicon-search input-icon"></i> <input ng-model=condition class="form-control rounded input-sm" placeholder=\'搜索"{{driectoryName}}"\'></div></div></div></div><div class="bg-light lter app-inner" ng-click=onContainerClick(); ng-right-click=showContainerContextMenu($event)><div class="table-responsive file-list" ng-if="mode== \'list\'" ng-show="files.length > 0 && !loading"><table class="table b-b b-light lter file-table"><thead><tr><th width=5%><label class="i-checks i-checks-sm m-b-none" ng-show=!condition><input type=checkbox ng-click=selecteAll() ng-checked=isSelectAll><i></i></label></th><th ng-click="changeSort(\'name\')" width=40%>名称 <i ng-show="sortField == \'name\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'size\')" width=10%>大小 <i ng-show="sortField == \'size\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'creationBy.name\')" width=15%>创建者 <i ng-show="sortField == \'creationBy.name\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'updateDate\')" width=15%>修改时间 <i ng-show="sortField == \'updateDate\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th width=15%></th></tr></thead><tbody><tr ng-repeat="file in files|orderBy:sortFields:sortDesc | filter:{name:condition,tags:condition}" class="file-item hc-item" ng-class="{true:\'active\'}[file.selected]" valign=middle ng-right-click=showContextMenu(file,$event)><td width=5%><label class="i-checks i-checks-sm m-b-none"><input type=checkbox ng-checked=file.selected ng-click=select(file,null,$event);><i></i></label></td><td ng-click=select(file,null) class=text-ellipsis><div class=pos-rlt><div class=file-icon-wrapper><img class=file-icon ng-src={{getIcon(file)}}></div><div class="pos-abt file-locker bg-primary rounded text-white" ng-if="file.locked === true" tooltip-placement=right tooltip={{file.lockedBy.name}}在{{file.lockeDate}}锁定><i class="fa fa-lock"></i></div><a ng-click=open(file,$event); class=pos-rlt title={{file.name}}>{{file.name}}</a><div class="file-tags clearfix" ng-show="showTags && file.tags"><div class=i-tag ng-repeat="tag in file.tags.split(\',\') track by $index"><span>{{tag}}</span></div></div></div></td><td ng-click=select(file,null,$event)>{{file.size | formatSize}}</td><td ng-click=select(file,null,$event)><img ng-if=file.creationBy ng-src="{{file.creationBy.avatar | resource}}" class=img-circle style=height:30px;float:left alt=...> <span class=m-l-xs>{{file.creationBy.name}}</span></td><td ng-click=select(file,null,$event)>{{file.updateDate}}</td><td class=text-center valign=middle ng-click=select(file,null,$event)><i class="file-option-icon glyphicon glyphicon-cloud-download" tooltip=下载 ng-click=download(file)></i> <i class="file-option-icon fa fa-paper-plane" ng-click=sendFile(file) tooltip=发送></i> <i class="file-option-icon fa fa-star" ng-if=file.favorited ng-click=removeFavorite(file,$event) tooltip=取消收藏></i> <i class="file-option-icon fa fa-star-o" ng-if=!file.favorited ng-click=addFavorite(file,$event) tooltip=收藏></i></td></tr></tbody></table></div><div ng-if="mode == \'block\'"><ul class=file-block-list><li class="file-block pos-rlt" ng-class="{true:\'active\'}[file.selected]" ng-click=select(file,null,$event) ng-dblclick=open(file); ng-right-click=showContextMenu(file,$event) ng-repeat="file in files|orderBy:sortField:sortDesc | filter:{name:condition}"><img class=file-icon ng-src={{getIcon(file)}}><div class="pos-abt file-locker bg-primary rounded text-white" ng-if="file.locked === true" tooltip-placement=right tooltip={{file.lockedBy.name}}在{{file.lockeDate}}锁定><i class="fa fa-lock"></i></div><div class="file-name text-ellipsis m-t-sm" title={{file.name}} tooltip-placement=bottom>{{file.name}}</div></li></ul></div><div class="wrapper-xl text-center" ng-show=loading><img ng-src="{{\'asset/img/loading.gif\' | resource}}"><p class=m-t-sm>正在加载</p></div><div class="wrapper-xl text-center" ng-show="(files.length == 0 || !files) && !loading"><img ng-src="{{\'asset/img/empty.png\' | resource}}"><p class=m-t-md>该文件夹中没有文件</p><button ng-if="" class="btn btn-primary" onclick="Util.openSelectFileDialog(\'#uploadFile\')" ng-show="checkPermission(\'upload\')"><i class="glyphicon glyphicon-cloud-upload"></i>上传文件</button></div></div></div><div class="wrapper-xl text-center" ng-show=error><img ng-src="{{\'asset/img/error.png\' | resource}}"><p class=m-t-md>加载文件夹失败：{{error}}</p></div><ul id=fileContextMenu class=dropdown-menu role=menu><li ng-click=showPermission(selected) ng-show=authorizeSetPermissions(selected)><a tabindex=-1 href=""><i class="fa fa-lock"></i> 设置权限</a></li><li ng-click=open(selected)><a tabindex=-1 href=""><i class="glyphicon glyphicon-new-window"></i> 打开</a></li><li><a tabindex=-1 href="" ng-click=download(selected)><i class="glyphicon glyphicon-cloud-download"></i> 下载</a></li><li ng-click=move(selected) ng-show="authorize(\'move\',selected)"><a tabindex=-1 href=""><i class="glyphicon glyphicon-transfer"></i> 移动</a></li><li ng-click=copy(selected) ng-show="authorize(\'copy\',selected)"><a tabindex=-1 href=""><i class="glyphicon glyphicon-copy"></i> 复制</a></li><li ng-click=rename(selected) ng-show="authorize(\'edit\',selected)"><a tabindex=-1 href=""><i class="glyphicon glyphicon-edit"></i> 重命名</a></li><li ng-if="checkPermission(\'lock\')" ng-click=lock(selected) ng-show="selected.type == \'file\' && selected.locked !== true"><a tabindex=-1 href=""><i class="glyphicon glyphicon-lock"></i> 锁定</a></li><li ng-if="checkPermission(\'lock\')" ng-click=unlock(selected) ng-show="selected.locked === true && selected.lockedBy.id == user.id"><a tabindex=-1 href=""><i class="fa fa-unlock-alt"></i> 解锁</a></li><li ng-click=uploadNewVersion(selected) ng-show="selected.type == \'file\' && authorize(\'upload\',selected)"><a tabindex=-1 href=""><i class="glyphicon glyphicon-cloud-upload"></i> 上传新版本</a></li><li ng-click=remove(selected) ng-show="checkPermission(\'remove\',selected)"><a tabindex=-1 href=""><i class="glyphicon glyphicon-trash"></i> 删除</a></li><li ng-if="checkPermission(\'tag\')" ng-click=setTag(selection[0])><a href><i class="fa fa-tag"></i>&nbsp;标签</a></li><li class=dropdown-submenu><a tabindex=-1 href=""><i class="fa fa-share-alt"></i>&nbsp;分享 <span class="pull-right m-r-n-md"><i class="fa fa-fw fa-angle-right text"></i></span></a><ul class=dropdown-menu role=menu style=left:-100%><li ng-click=sendFile(selected)><a href><i class="fa fa-paper-plane"></i>&nbsp;发送给同事</a></li><li ng-click=share(selected)><a href><i class="fa fa-link"></i>&nbsp;链接分享</a></li></ul></li></ul><ul id=containerContextMenu class=dropdown-menu role=menu><li ng-click=createDirectory() ng-show="checkPermission(\'create\')"><a tabindex=-1 href="">新建</a></li><li class=dropdown-submenu><a tabindex=-1 href="">查看 <span class="pull-right m-r-n-md"><i class="fa fa-fw fa-angle-right text"></i></span></a><ul class=dropdown-menu role=menu><li ng-click="switchMode(\'list\')"><a tabindex=-1 href=""><i class=fa ng-class="{true:\'fa-dot-circle-o\',false:\'fa-circle-o\'}[mode == \'list\']"></i> 列表模式</a></li><li ng-click="switchMode(\'block\')"><a tabindex=-1 href=""><i class=fa ng-class="{true:\'fa-dot-circle-o\',false:\'fa-circle-o\'}[mode == \'block\']"></i> 图标模式</a></li></ul></li><li class=dropdown-submenu><a tabindex=-1 href="">排序 <span class="pull-right m-r-n-md"><i class="fa fa-fw fa-angle-right text"></i></span></a><ul class=dropdown-menu role=menu><li ng-click="changeSort(\'name\')"><a tabindex=-1 href=""><i class=fa ng-class="{true:\'fa-dot-circle-o\',false:\'fa-circle-o\'}[sortField == \'name\']"></i> 名称</a></li><li ng-click="changeSort(\'size\')"><a tabindex=-1 href=""><i class=fa ng-class="{true:\'fa-dot-circle-o\',false:\'fa-circle-o\'}[sortField == \'size\']"></i> 大小</a></li><li ng-click="changeSort(\'creationBy.name\')"><a tabindex=-1 href=""><i class=fa ng-class="{true:\'fa-dot-circle-o\',false:\'fa-circle-o\'}[sortField == \'creationBy.name\']"></i> 创建者</a></li><li ng-click="changeSort(\'updateDate\')"><a tabindex=-1 href=""><i class=fa ng-class="{true:\'fa-dot-circle-o\',false:\'fa-circle-o\'}[sortField == \'updateDate\']"></i> 时间</a></li></ul></li><li role=separator class=divider></li><li ng-click=reload()><a tabindex=-1 href="">刷新</a></li></ul>'),e.put("asset/tpl/dropbox.html",'<div class=m-c><div class=modal-header><h4 class=modal-title><i class="glyphicon glyphicon-cloud-upload"></i> 上传文件</h4></div><div class="modal-body no-padder"><div class="dropbox-list wrapper-sm"><div class=dropbox-item ng-repeat="file in files"><div class="dropbox-item-inner wrapper-xs"><div class=file-name><img class=file-icon ng-src={{getIcon(file)}}> {{file.name}}</div><div class=file-size>{{file.size | formatSize}}</div><div class="file-operation text-center"><i class="fa fa-remove hover" ng-click=remove(file);></i></div><div class=clearfix></div></div></div></div><div class="wrapper-sm b-t"><form name=dropboxForm class="form-horizontal form-validation"><div class="form-group m-b-none"><label class="col-sm-2 control-label">上传到：</label><div class=col-sm-10><hc-combo-tree ng-model=directory tree-config=treeConfig on-before-load=setParam(node,params) text-field=fullName on-change=onChange(node);></hc-combo-tree></div></div><div class=form-group ng-show=result><div class="col-sm-12 m-t-md text-center"><div class="alert alert-danger m-b-none" role=alert>{{result.message}}</div></div></div><div class="alert alert-danger m-b-none" ng-show="allowed === false">企业文档根目录不允许上传文件</div></form></div></div><div class=modal-footer><button type=button class="btn btn-primary" ng-click=ok() ng-disabled="allowed === false">上传</button> <button type=button class="btn btn-default" ng-click=cancel()>取消</button></div></div>'),e.put("asset/tpl/favorites.html",'<div class=app-ctrl style="padding-top:90px;overflow: hidden" ng-show=!error><div class="b-b app-title-fixed padder"><div class="row wrapper-xs b-b bg-light"><div class="col-sm-9 col-xs-9 padder-sm"><span class="m-n directory-header text-md"><i class="fa fa-star"></i> 收藏夹 </span><span class="text-sm m-l-xs" ng-show="files.length > 0">( <span ng-show="selection.length > 0">{{selection.length}} / </span>{{files.length}} )</span></div><div class="col-sm-3 col-xs-3 padder-sm"><div class=pull-right><button class="btn btn-md btn-default" ng-click=switchMode()><i class=fa ng-class="{ true:\'fa-list\',false:\'fa-th\'}[mode == \'list\']"></i> <span ng-show="mode == \'list\'">列表视图</span> <span ng-show="mode == \'block\'">图标视图</span></button><div class=btn-group dropdown is-open=openSortmenu><button type=button class="btn btn-md btn-default" ng-click=changeDesc();><i ng-class="{\'fa-long-arrow-down\' : sortDesc,\'fa-long-arrow-up\':!sortDesc}" class=fa></i> <span ng-show="sortField == \'name\'">名称</span> <span ng-show="sortField == \'size\'">大小</span> <span ng-show="sortField == \'creationBy.name\'">创建者</span> <span ng-show="sortField == \'updateDate\'">时间</span></button> <button type=button class="btn btn-md btn-default dropdown-toggle" dropdown-toggle><span class=caret></span></button><ul class=dropdown-menu role=menu style="left: inherit; right: 0px"><li><a href ng-click="changeSort(\'name\')">名称</a></li><li><a href ng-click="changeSort(\'size\')">大小</a></li><li><a href ng-click="changeSort(\'creationBy.name\')">创建者</a></li><li><a href ng-click="changeSort(\'updateDate\')">时间</a></li></ul></div></div></div></div><div class="row wrapper-xs bg-light lter"><div class="col-sm-10 col-xs-10 padder-sm"><button class="btn btn-md btn-default" ng-click=open(selection[0],$event) ng-show="selection.length == 1 && selection[0].type == \'file\'"><i class="glyphicon glyphicon-new-window"></i> 打开文件</button> <button class="btn btn-md btn-default" ng-click=openParent(selection[0],$event) ng-show="selection.length == 1 && selection[0].type == \'file\'"><i class="fa fa-folder-open"></i> 打开所在文件夹</button> <button class="btn btn-md btn-default" ng-click=open(selection[0],$event) ng-show="selection.length == 1 && selection[0].type == \'directory\'"><i class="fa fa-folder-open"></i> 打开文件夹</button> <button class="btn btn-md btn-default" ng-click=removeFavorite(); ng-show="selection.length > 0"><i class="glyphicon glyphicon-trash"></i> 删除收藏</button></div><div class="col-sm-2 col-xs-2 text-right padder-sm"><div class="input-group-icon directory-search"><i class="glyphicon glyphicon-search input-icon"></i> <input ng-model=condition class="form-control input-sm rounded" placeholder=\'搜索"收藏夹"\'></div></div></div></div><div class="bg-light lter app-inner" ng-click=onContainerClick();><div class="table-responsive file-list" ng-if="mode== \'list\'" ng-show="files.length > 0 && !loading"><table class="table b-b b-light lter file-table"><thead><tr><th width=5%><label class="i-checks i-checks-sm m-b-none" ng-show=!condition><input type=checkbox ng-click=selecteAll() ng-checked=isSelectAll><i></i></label></th><th ng-click="changeSort(\'name\')" width=40%>名称 <i ng-show="sortField == \'name\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'size\')" width=10%>大小 <i ng-show="sortField == \'size\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'creationBy.name\')" width=15%>创建者 <i ng-show="sortField == \'creationBy.name\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'updateDate\')" width=15%>修改时间 <i ng-show="sortField == \'updateDate\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th></tr></thead><tbody><tr ng-repeat="file in files|orderBy:sortFields:sortDesc | filter:{name:condition}" class="file-item hc-item" ng-class="{true:\'active\'}[file.selected]" valign=middle ng-click=select(file)><td width=5%><label class="i-checks i-checks-sm m-b-none"><input type=checkbox ng-checked=file.selected ng-click=select(file);><i></i></label></td><td class=text-ellipsis><a ng-click=open(file,$event);><div class=file-icon-wrapper><img class=file-icon ng-src={{getIcon(file)}}></div>{{file.name}}</a></td><td>{{file.size | formatSize}}</td><td><img ng-if=file.creationBy ng-src="{{file.creationBy.avatar | resource}}" class=img-circle style=height:30px;float:left alt=...> <span class=m-l-xs>{{file.creationBy.name}}</span></td><td>{{file.updateDate}}</td></tr></tbody></table></div><div ng-if="mode == \'block\'"><ul class=file-block-list><li class=file-block ng-class="{true:\'active\'}[file.selected]" ng-click=select(file,null,$event) ng-dblclick=open(file,$event); ng-repeat="file in files|orderBy:sortField:sortDesc | filter:{name:condition}"><img class=file-icon ng-src={{getIcon(file)}}><div class="file-name text-ellipsis m-t-sm" tooltip={{file.name}} tooltip-placement=bottom>{{file.name}}</div></li></ul></div><div class="wrapper-xl text-center" ng-show=loading><img ng-src="{{\'asset/img/loading.gif\' | resource}}"><p class=m-t-sm>正在加载</p></div><div class="wrapper-xl text-center" ng-show="(files.length == 0 || !files) && !loading"><img ng-src="{{\'asset/img/empty.png\' | resource}}"><p class=m-t-md>收藏夹中没有文件</p></div></div></div><div class="wrapper-xl text-center" ng-show=error><img ng-src="{{\'asset/img/error.png\' | resource}}"><p class=m-t-md>加载文件夹失败：{{error}}</p></div>'),e.put("asset/tpl/file_send.html",'<div class=m-c><div class=modal-header><h4 class=modal-title><i class="fa fa-paper-plane"></i> 发送文件</h4></div><div class="modal-body no-padder"><div class="dropbox-list wrapper-sm"><div class=dropbox-item ng-repeat="file in files"><div class="dropbox-item-inner wrapper-xs clearfix"><div class=file-name><img class=file-icon ng-src={{getIcon(file)}}> {{file.name}}</div><div ng-if=file.size class=file-size>{{file.size | formatSize}}</div><div ng-if=!file.size class=file-size>&nbsp;</div><div class="file-operation text-center"><i class="fa fa-remove hover" ng-click=remove(file);></i></div></div></div></div><div class="wrapper-sm b-t clearfix"><form class=form-horizontal><div class=form-group><label class="col-sm-2 control-label">接收人:</label><div class=col-sm-10><div class="permission-user-selected wrapper-sm text-center inline hover-bg" ng-repeat="user in users"><button type=button class=close ng-click=removeReceiver(user)><span aria-hidden=true>×</span></button> <img ng-src="{{user.avatar | resource}}" class=img-circle style=height:35px alt=...><div class="text-ellipsis m-t-xs text-sm">{{user.name}}</div></div><div><button class="btn btn-default btn-md btn-sm m-t-xs" ng-click=addReceiver();><i class="fa fa-users"></i> 选择接收人</button></div></div></div><div class=form-group><label class="col-sm-2 control-label">留言：</label><div class=col-sm-10><input class=form-control ng-model=content></div></div></form></div></div><div class=modal-footer><button type=button class="btn btn-primary" ng-click=ok() ng-disabled="!users || users.length == 0 || !files || files.length == 0"><i class="fa fa-paper-plane"></i> 发送</button> <button type=button class="btn btn-default" ng-click=cancel()>取消</button></div></div>'),e.put("asset/tpl/file.html",'<div class="wrapper-xl text-center" ng-show=loading><img ng-src="{{\'asset/img/loading.gif\' | resource}}"><p class=m-t-sm>正在加载...</p></div><div class="wrapper-xl text-center" ng-show=error><img ng-src="{{\'asset/img/error.png\' | resource}}"><p>加载文件失败：{{error}}</p><button class="btn btn-default" ng-click=close()><i class="glyphicon glyphicon-chevron-left"></i>返回</button></div><div class="m-c h-full" ng-show="!loading && !error" style="overflow: hidden"><div class="modal-header pos-fix w-full wrapper-sm bg-primary text-white" style=z-index:99><div class="navbar-header pull-right fild-detail-toolbar"><button class="pull-right hover" ng-click=close(); tooltip=关闭 tooltip-placement=bottom><i class="glyphicon glyphicon-remove"></i></button> <button class="pull-right hover" ng-click="hiddenDetail = !hiddenDetail" tooltip=切换详情栏 tooltip-placement=bottom><i class="glyphicon glyphicon-align-justify"></i></button> <button class="pull-right hover" ng-click=fullScreen(); ng-show=supportFullScreen tooltip=全屏 tooltip-placement=bottom><i class="glyphicon glyphicon-resize-full"></i></button> <button class="pull-right hover" ng-if="file.locked !== true" ng-click=remove() ng-show="checkPermission(\'remove\')" tooltip=删除 tooltip-placement=bottom><i class="glyphicon glyphicon-trash"></i></button> <button class="pull-right hover" ng-click=copy() ng-show="checkPermission(\'copy\')" tooltip=复制 tooltip-placement=bottom><i class="glyphicon glyphicon-copy"></i></button> <button class="pull-right hover" ng-if="file.locked !== true" ng-click=move() ng-show="checkPermission(\'move\')" tooltip=移动 tooltip-placement=bottom><i class="fa fa-share-square-o"></i></button> <button class="pull-right hover" ng-if="file.locked !== true" ng-click=rename() ng-show="checkPermission(\'rename\')" tooltip=重命名 tooltip-placement=bottom><i class="glyphicon glyphicon-edit"></i></button> <button class="pull-right hover" ng-if="file.locked !== true" ng-click=uploadNewVersion(file) ng-show="checkPermission(\'upload\')" tooltip=上传新版本 tooltip-placement=bottom><i class="glyphicon glyphicon-cloud-upload"></i></button></div><h4 class=modal-title style="line-height: 34px"><img ng-src={{file.icon}} style="max-height: 30px;max-width: 30px; margin-top: -2px"> <span class=m-l-xs>{{current.name}}<span ng-if=!current.current>&nbsp;，版本：V{{current.versionNo}}</span></span></h4></div><div class="modal-body h-full" style="padding: 55px 0px 0px 0px"><div id=file-preview-container class="h-full no-padder bg-light" ng-class="{\'col-sm-12\':hiddenDetail,\'col-sm-9\':!hiddenDetail}"><div ng-if="current.media == \'image\'" class="h-full text-center file-image-container"><div class="file-image-wrapper w-full h-full wrapper-xl"><img ng-src={{geImageSrc(current)}} ng-class="{\'file-image-fill\':!full}" style=transform:rotate({{deg}}deg)></div><div class="file-image-tools b"><button class=hover tooltip=原始大小 ng-show=!full ng-click="full = !full"><i class="glyphicon glyphicon-resize-full"></i></button> <button class=hover tooltip=自适应 ng-show=full ng-click="full = !full"><i class="glyphicon glyphicon-resize-small"></i></button> <button class=hover tooltip=旋转 ng-click=rotate()><i class="glyphicon glyphicon-repeat"></i></button></div></div><div ng-if="current.media == \'document\'" class=h-full><iframe ng-src={{getPreviewUrl(current)}} width=100% height=100% frameborder=0 scrolling=yes></iframe></div><div ng-if="current.media == \'unknow\'" class="h-full wrapper-xl text-center"><img ng-src="{{\'asset/img/info.png\' | resource}}" style="height: 180px"><p>该文件不支持在线预览，请下载后在本地打开</p><button class="btn btn-default" ng-click=download()><i class="glyphicon glyphicon-cloud-download"></i> 下载</button></div></div><div class="no-padder b-l h-full wrapper-sm" ng-class="{\'hidden\':hiddenDetail,\'col-sm-3\':!hiddenDetail}" style="overflow: auto"><tabset justified=true class="tab-container file-tab"><tab heading=详情><div class="wrapper-sm text-center b-b"><img ng-src={{current.icon}} style=max-height:80px><p class="m-t-xs font-bold m-b-none" style=word-break:break-all>{{current.name}}</p><div class="text-2x m-t-sm"><i ng-if="checkPermission(\'lock\')" ng-show="current.current && current.locked !== true" ng-click=lock(); class="fa fa-lock hover" tooltip=锁定></i> <i ng-if="checkPermission(\'lock\')" ng-show="current.current && current.locked === true && current.lockedBy.id == user.id" class="fa fa-unlock-alt hover" tooltip=解锁 ng-click=unlock();></i> <i ng-if="favorited && current.current" ng-click=removeFavorite(); class="fa fa-star hover" tooltip=取消收藏></i> <i ng-if="!favorited && current.current" ng-click=addFavorite(); class="fa fa-star-o hover hover" tooltip=收藏></i> <i class="glyphicon glyphicon-cloud-download m-r-sm hover" ng-click=download() ng-show="checkPermission(\'download\')" tooltip=下载></i></div></div><div class="wrapper-sm clearfix" style="line-height: 30px"><div class="col-sm-4 font-bold text-right m-t-xs">文件大小:</div><div class="col-sm-8 m-t-xs">{{current.size | formatSize}}</div><div class="col-sm-4 font-bold text-right m-t-xs">创建者:</div><div class="col-sm-8 m-t-xs"><img ng-src="{{current.createdBy.avatar | resource}}" class=img-circle style=height:30px;float:left alt=...> <span class=m-l-xs>{{current.createdBy.name}}</span></div><div class="col-sm-4 font-bold text-right m-t-xs">创建时间:</div><div class="col-sm-8 m-t-xs">{{current.createDate}}</div><div class="col-sm-4 font-bold text-right m-t-xs">标签:</div><div class="col-sm-8 m-t-xs"><div class=i-tag style=line-height:1.42857143 ng-repeat="tag in file.tags.split(\',\') track by $index"><span>{{tag}}</span></div><div ng-if=!file.tags class=text-muted>没有设置标签</div></div></div></tab><tab heading=评论><div class="wrapper-sm b-b"><form name=reviewForm><textarea ng-model=reviewContent name=reviewContent class=form-control rows=3></textarea><div class="text-right m-t-sm"><button class="btn btn-primary" ng-disabled=!reviewContent ng-click=addReview(reviewContent)>发表</button></div></form></div><div class="file-review b-b wrapper-sm hover-bg" ng-repeat="review in reviews"><a href title=删除评论 class=close ng-click=removeReview(review) ng-if="review.reviewer == user.id">×</a><div class=file-review-head><img ng-src="{{ review.avatar | resource }}" class=rounded><div class=file-review-user><div>{{review.name}}</div><div class="text-muted text-sm"><i class="fa fa-clock-o"></i> {{review.reviewDate}}</div></div></div><div class="m-t-xs file-review-content">{{review.content}}</div></div></tab><tab heading=版本><ul class=file-versions><li class="hover-bg lter wrapper-sm" ng-repeat="version in versions | orderBy:verisionNo"><div class=version-icon><img ng-src={{getIcon(version)}}></div><div title=预览该版本文件 ng-click=setCurrent(version);><span class="version-no label label-primary">V{{version.versionNo}}</span> <span class=version-name>{{version.name}}</span> <span ng-if=version.current class="label label-success version-current">最新</span></div><ul class=version-meta><li>{{version.creationBy.name}}</li><li>&nbsp;创建于 <span>{{version.createDate}}</span></li><li>&nbsp;{{version.size | formatSize}}</li></ul><div class=version-action><a ng-if=!version.current href=# ng-click=setVersion(version)>设置最新版本</a> <span ng-if=!version.current>|</span> <a ng-if=!version.current href=# ng-click=deleteVersion(version)>删除</a> <span ng-if=!version.current>|</span> <a class=download ng-click=download(version)>下载</a></div></li></ul></tab></tabset></div></div></div>'),e.put("asset/tpl/messages.html",'<div class=app-ctrl style="padding-top:76px;overflow: hidden" ng-show=!error><div class="b-b app-title-fixed padder"><div class="row wrapper-md bg-light lter"><div class="col-sm-9 col-xs-9 padder-sm"><span class="m-n directory-header h3"><i class="glyphicon glyphicon-comment"></i> 消息通知</span></div></div></div><div class="bg-white wrapper-md app-inner"><div class=m-b ng-repeat="message in messages"><a href class="pull-left thumb-xs avatar"><img ng-src="{{message.senderAvatar | resource}}" alt=...><p class="m-t-xs text-xs text-ellipsis">{{message.senderName}}</p></a><div class=clear><div class="pos-rlt wrapper-sm b bg-light r m-l-sm message"><span class="arrow left pull-up arrow-light"></span><p class=m-b-xs ng-if=message.content>留言：{{message.content}}</p><div class="message-file pos-rlt" ng-if=message.file>文件： <a ng-click=open(message.file) class="file-box wrapper-sm clearfix pos-rlt b bg-light lter" href=""><div class="file-icon text-center"><img ng-src={{getIcon(message.file)}}></div><div class=file-content><div class=file-name>{{message.file.name}}</div><div class=file-size ng-if=message.file.size>{{message.file.size | formatSize}}</div><div class=file-size ng-if=!message.file.size>&nbsp;</div></div></a></div></div><small class="text-muted m-l-sm message-date"><i class="fa fa-ok text-success"></i>{{message.sendDate}}</small></div></div></div><div class="wrapper-xl text-center" ng-show=loading><img ng-src="{{\'asset/img/loading.gif\' | resource}}"><p class=m-t-sm>正在加载</p></div><div class="wrapper-xl text-center" ng-show="(files.length == 0 || !files) && !loading"><img ng-src="{{\'asset/img/empty.png\' | resource}}"><p class=m-t-md>没有未读消息</p></div></div><div class="wrapper-xl text-center" ng-show=error><img ng-src="{{\'asset/img/error.png\' | resource}}"><p class=m-t-md>加载文件夹失败：{{error}}</p></div>'),e.put("asset/tpl/move.html",'<div class=m-c><div class=modal-header><h4 class=modal-title>移动文件(夹)</h4></div><div class="modal-body no-padder"><div class=permission-user-body><div class="col-sm-12 permission-user-part b-r wrapper-sm"><div class=wrapper-xs>选择要移动到的位置</div><hc-tree tree-control=tree load-asyn=true leaf-icon="fa fa-folder" on-node-dbl-click=select(node); on-selection-change=setTarget(selection); on-before-load=setParam(node,params); load-url=/fs/folder></hc-tree></div></div><div class="wrapper-sm b-t row m-l-none m-r-none" ng-show=target><b>将移动到：</b><span>{{paths}}</span></div><div class="wrapper-sm b-t row m-l-none m-r-none" ng-show=isRepeat>所选的文件已经在该文件夹中，请选择其他文件夹。</div></div><div class=modal-footer><button type=button class="btn btn-primary" ng-click=ok() ng-disabled=!target>确定</button> <button type=button class="btn btn-default" ng-click=close()>取消</button></div></div>'),e.put("asset/tpl/profile.html",'<div class=app-ctrl style="padding-top:76px;overflow: hidden" ng-show=!error><div class="b-b app-title-fixed padder"><div class="row wrapper-md bg-light"><div class="col-sm-9 col-xs-9 padder-sm"><span class="m-n directory-header h3"><i class="fa fa-user"></i> 个人设置</span></div><div class="col-sm-3 col-xs-3" style="text-align: right"><button class="btn btn-primary" ng-disabled="userSettingForm.$invalid || !userSettingForm.$dirty" ng-click=save()>保存</button></div></div></div><div class="bg-light wrapper-md lter app-inner"><form name=userSettingForm class="form-horizontal form-property form-validation"><div class="panel panel-default"><div class="panel-heading font-bold">个人信息</div><div class=panel-body><div class="form-group m-b-sm"><label class="col-sm-5 control-label">用户名</label><div class="col-sm-7 control-label">{{user.username}}</div></div><div class="line line-dashed b-b line-lg"></div><div class="form-group m-b-sm"><label class="col-sm-5 control-label">邮箱</label><div class=col-sm-7><input type=email name=name ng-model=user.email required class="form-control w-md"></div></div><div class="line line-dashed b-b line-lg"></div><div class=form-group><label class="col-sm-5 control-label">姓名</label><div class=col-sm-7><input name=name ng-model=user.name required class="form-control w-md"></div></div><div class="line line-dashed b-b line-lg"></div><div class=form-group><label class="col-sm-5 control-label">头像</label><input id=avatarInput type=file class=hidden onchange=angular.element(this).scope().upload()><div class="col-sm-7 m-b-sm"><div><img ng-src="{{user.avatar | resource}}" class="rounded w-xs m-b-sm avatar-img"></div><button class="btn btn-default" ng-click=selectAvatar() ng-disabled=uploading><span ng-show=uploading>正在上传</span> <span ng-show=!uploading>选择头像</span></button> 推荐尺寸240*240，大小不超过2MB<div class="alert alert-danger m-t-sm m-b-none w-md" ng-show="result.success === false" role=alert>{{result.message}}</div></div></div><div class="line line-dashed b-b line-lg"></div><div class="form-group m-b-sm"><label class="col-sm-5 control-label">部门</label><div class="col-sm-7 control-label">{{user.department.name}}</div></div><div class="line line-dashed b-b line-lg"></div><div class=form-group><label class="col-sm-5 control-label">个人空间</label><div class="col-sm-7 control-label"><div class=m-b-xs>总共：{{space.quato | formatSize}}，已用：{{space.used | formatSize}}</div><progressbar value=space.quatoPrecent type=white class="progress-xs m-b-none dker w-md"></progressbar></div></div></div></div><div class="panel panel-default"><div class="panel-heading font-bold">偏好设置</div><div class=panel-body><div class="form-group m-b-sm"><label class="col-sm-5 control-label">文件显示模式</label><div class=col-sm-7><label class="checkbox-inline i-checks"><input type=radio name=mode value=list ng-checked="user.mode == \'list\'" ng-model=user.mode><i></i> 列表模式</label><label class="checkbox-inline i-checks"><input type=radio name=mode value=block ng-checked="user.mode == \'block\'" ng-model=user.mode><i></i> 图标模式</label></div></div><div class="line line-dashed b-b line-lg"></div><div class="form-group m-b-sm"><label class="col-sm-5 control-label">排序字段</label><div class=col-sm-7><label class="checkbox-inline i-checks"><input type=radio name=sortField value=name ng-checked="user.sortField == \'name\'" ng-model=user.sortField><i></i> 名称</label><label class="checkbox-inline i-checks"><input type=radio name=sortField value=size ng-checked="user.sortField == \'size\'" ng-model=user.sortField><i></i> 大小</label><label class="checkbox-inline i-checks"><input type=radio name=sortField value=updateDate ng-checked="user.sortField == \'updateDate\'" ng-model=user.sortField><i></i> 时间</label><label class="checkbox-inline i-checks"><input type=radio name=sortField value=creationBy.name ng-checked="user.sortField == \'creationBy.name\'" ng-model=user.sortField><i></i> 创建者</label></div></div><div class="line line-dashed b-b line-lg"></div><div class="form-group m-b-sm"><label class="col-sm-5 control-label">排序模式</label><div class=col-sm-7><label class="checkbox-inline i-checks"><input type=radio name=sortDesc value=false ng-checked="user.sortDesc !== true" ng-model=user.sortDesc><i></i> 升序</label><label class="checkbox-inline i-checks"><input type=radio name=sortDesc value=true ng-checked="user.sortDesc === true" ng-model=user.sortDesc><i></i> 降序</label></div></div></div></div></form></div></div>'),e.put("asset/tpl/recent.html",'<div class=app-ctrl style="padding-top:90px;overflow: hidden" ng-show=!error><div class="b-b app-title-fixed padder"><div class="row wrapper-xs b-b bg-light"><div class="col-sm-9 col-xs-9 padder-sm"><span class="m-n directory-header text-md"><i class="fa fa-clock-o"></i> 最近打开 </span><span class="text-sm m-l-xs" ng-show="files.length > 0">( <span ng-show="selection.length > 0">{{selection.length}} / </span>{{files.length}} )</span></div><div class="col-sm-3 col-xs-3 padder-sm"><div class=pull-right><button class="btn btn-md btn-default" ng-click=switchMode()><i class=fa ng-class="{ true:\'fa-list\',false:\'fa-th\'}[mode == \'list\']"></i> <span ng-show="mode == \'list\'">列表视图</span> <span ng-show="mode == \'block\'">图标视图</span></button><div class=btn-group dropdown is-open=openSortmenu><button type=button class="btn btn-md btn-default" ng-click=changeDesc();><i ng-class="{\'fa-long-arrow-down\' : sortDesc,\'fa-long-arrow-up\':!sortDesc}" class=fa></i> <span ng-show="sortField == \'name\'">名称</span> <span ng-show="sortField == \'size\'">大小</span> <span ng-show="sortField == \'creationBy.name\'">创建者</span> <span ng-show="sortField == \'updateDate\'">时间</span></button> <button type=button btn-md class="btn btn-md btn-default dropdown-toggle" dropdown-toggle><span class=caret></span></button><ul class=dropdown-menu role=menu style="left: inherit; right: 0px"><li><a href ng-click="changeSort(\'name\')">名称</a></li><li><a href ng-click="changeSort(\'size\')">大小</a></li><li><a href ng-click="changeSort(\'creationBy.name\')">创建者</a></li><li><a href ng-click="changeSort(\'updateDate\')">时间</a></li></ul></div></div></div></div><div class="row wrapper-xs bg-light lter"><div class="col-sm-10 col-xs-10 padder-sm"><button class="btn btn-md btn-default" ng-click=open(selection[0],$event) ng-show="selection.length == 1 && selection[0].type == \'file\'"><i class="glyphicon glyphicon-new-window"></i> 打开文件</button> <button class="btn btn-md btn-default" ng-click=openParent(selection[0],$event) ng-show="selection.length == 1 && selection[0].type == \'file\'"><i class="fa fa-folder-open"></i> 打开所在文件夹</button> <button class="btn btn-md btn-default" ng-click=open(selection[0],$event) ng-show="selection.length == 1 && selection[0].type == \'directory\'"><i class="fa fa-folder-open"></i> 打开文件夹</button> <button class="btn btn-md btn-default" ng-click=removeRecent() ng-show="selection.length > 0"><i class="glyphicon glyphicon-trash"></i> 删除记录</button> <button class="btn btn-md btn-default" ng-click=clear() ng-show="files.length > 0"><i class="glyphicon glyphicon-trash"></i> 清空记录</button></div><div class="col-sm-2 col-xs-2 text-right padder-sm"><div class="input-group-icon directory-search"><i class="glyphicon glyphicon-search input-icon"></i> <input ng-model=condition class="form-control input-sm rounded" placeholder=\'搜索"最近打开"\'></div></div></div></div><div class="bg-light lter app-inner" ng-click=onContainerClick();><div class="table-responsive file-list" ng-if="mode== \'list\'" ng-show="files.length > 0 && !loading"><table class="table b-b b-light lter file-table"><thead><tr><th width=5%><label class="i-checks i-checks-sm m-b-none" ng-show=!condition><input type=checkbox ng-click=selecteAll() ng-checked=isSelectAll><i></i></label></th><th ng-click="changeSort(\'name\')" width=40%>名称 <i ng-show="sortField == \'name\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'size\')" width=10%>大小 <i ng-show="sortField == \'size\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'creationBy.name\')" width=15%>创建者 <i ng-show="sortField == \'creationBy.name\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'updateDate\')" width=15%>修改时间 <i ng-show="sortField == \'updateDate\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th></tr></thead><tbody><tr ng-repeat="file in files|orderBy:sortFields:sortDesc | filter:{name:condition}" class="file-item hc-item" ng-class="{true:\'active\'}[file.selected]" valign=middle><td width=5%><label class="i-checks i-checks-sm m-b-none"><input type=checkbox ng-checked=file.selected ng-click=select(file,null,$event);><i></i></label></td><td ng-click=select(file,null,$event) class=text-ellipsis><a ng-click=open(file,$event);><div class=file-icon-wrapper><img class=file-icon ng-src={{getIcon(file)}}></div>{{file.name}}</a></td><td ng-click=select(file,null,$event)>{{file.size | formatSize}}</td><td ng-click=select(file,null,$event)><img ng-if=file.creationBy ng-src="{{file.creationBy.avatar | resource}}" class=img-circle style=height:30px;float:left alt=...> <span class=m-l-xs>{{file.creationBy.name}}</span></td><td ng-click=select(file,null,$event)>{{file.updateDate}}</td></tr></tbody></table></div><div ng-if="mode == \'block\'"><ul class=file-block-list><li class=file-block ng-class="{true:\'active\'}[file.selected]" ng-click=select(file,null,$event) ng-dblclick=open(file,$event); ng-repeat="file in files|orderBy:sortField:sortDesc | filter:{name:condition}"><img class=file-icon ng-src={{getIcon(file)}}><div class="file-name text-ellipsis m-t-sm" tooltip={{file.name}} tooltip-placement=bottom>{{file.name}}</div></li></ul></div><div class="wrapper-xl text-center" ng-show=loading><img ng-src="{{\'asset/img/loading.gif\' | resource}}"><p class=m-t-sm>正在加载</p></div><div class="wrapper-xl text-center" ng-show="(files.length == 0 || !files) && !loading"><img ng-src="{{\'asset/img/empty.png\' | resource}}"><p class=m-t-md>最近没有打开文件</p></div></div></div><div class="wrapper-xl text-center" ng-show=error><img ng-src="{{\'asset/img/error.png\' | resource}}"><p class=m-t-md>加载最近的文件失败：{{error}}</p></div>'),e.put("asset/tpl/recycle.html",'<div class=app-ctrl style="padding-top:90px;overflow: hidden" ng-show=!error><div class="b-b app-title-fixed padder"><div class="row wrapper-xs b-b bg-light"><div class="col-sm-9 col-xs-9 padder-sm"><span class="m-n directory-header text-md"><i class="glyphicon glyphicon-trash"></i> 回收站 </span><span class="text-sm m-l-xs" ng-show="files.length > 0">( <span ng-show="selection.length > 0">{{selection.length}} / </span>{{files.length}} )</span></div><div class="col-sm-3 col-xs-3 padder-sm"><div class=pull-right><button class="btn btn-md btn-default" ng-click=switchMode()><i class=fa ng-class="{ true:\'fa-list\',false:\'fa-th\'}[mode == \'list\']"></i> <span ng-show="mode == \'list\'">列表视图</span> <span ng-show="mode == \'block\'">图标视图</span></button><div class=btn-group dropdown is-open=openSortmenu><button type=button class="btn btn-md btn-default" ng-click=changeDesc();><i ng-class="{\'fa-long-arrow-down\' : sortDesc,\'fa-long-arrow-up\':!sortDesc}" class=fa></i> <span ng-show="sortField == \'name\'">名称</span> <span ng-show="sortField == \'size\'">大小</span><span ng-show="sortField == \'deleteBy.name\'">删除者</span> <span ng-show="sortField == \'updateDate\'">修改时间</span> <span ng-show="sortField == \'deleteDate\'">删除时间</span></button> <button type=button class="btn btn-md btn-default dropdown-toggle" dropdown-toggle><span class=caret></span></button><ul class=dropdown-menu role=menu style="left: inherit; right: 0px"><li><a href ng-click="changeSort(\'name\')">名称</a></li><li><a href ng-click="changeSort(\'size\')">大小</a></li><li><a href ng-click="changeSort(\'deleteBy.name\')">删除者</a></li><li><a href ng-click="changeSort(\'updateDate\')">修改时间</a></li><li><a href ng-click="changeSort(\'deleteDate\')">删除时间</a></li></ul></div></div></div></div><div class="row wrapper-xs bg-light lter"><div class="col-sm-10 col-xs-10 padder-sm"><button class="btn btn-md btn-default" ng-click=revert() ng-show="selection.length > 0"><i class="fa fa-recycle"></i> 恢复文件</button> <button class="btn btn-md btn-default" ng-click=openParent(selection[0],$event) ng-show="selection.length == 1"><i class="glyphicon glyphicon-new-window"></i> 打开所在文件夹</button> <button class="btn btn-md btn-default" ng-click=destroy() ng-show="selection.length > 0"><i class="fa fa-trash"></i> 彻底删除</button> <button class="btn btn-md btn-default" ng-click=clear() ng-show="files.length > 0"><i class="fa fa-trash-o"></i> 清空回收站</button></div><div class="col-sm-2 col-xs-2 text-right padder-sm"><div class="input-group-icon directory-search"><i class="glyphicon glyphicon-search input-icon"></i> <input ng-model=condition class="form-control input-sm rounded" placeholder=\'搜索"回收站"\'></div></div></div></div><div class="bg-light lter app-inner" ng-click=onContainerClick();><div class="table-responsive file-list" ng-if="mode== \'list\'" ng-show="files.length > 0 && !loading"><table class="table b-b b-light lter file-table"><thead><tr><th width=5%><label class="i-checks i-checks-sm m-b-none" ng-show=!condition><input type=checkbox ng-click=selecteAll() ng-checked=isSelectAll><i></i></label></th><th ng-click="changeSort(\'name\')" width=40%>名称 <i ng-show="sortField == \'name\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'size\')" width=10%>大小 <i ng-show="sortField == \'size\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'deleteBy.name\')" width=10%>删除者 <i ng-show="sortField == \'deleteBy.name\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'deleteDate\')" width=15%>删除时间 <i ng-show="sortField == \'deleteDate\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'updateDate\')" width=15%>修改时间 <i ng-show="sortField == \'updateDate\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th></tr></thead><tbody><tr ng-repeat="file in files|orderBy:sortFields:sortDesc | filter:{name:condition}" class="file-item hc-item" ng-class="{true:\'active\'}[file.selected]" valign=middle ng-click=select(file)><td width=5%><label class="i-checks i-checks-sm m-b-none"><input type=checkbox ng-checked=file.selected ng-click=select(file);><i></i></label></td><td class=text-ellipsis><a ng-click=open(file,$event);><div class=file-icon-wrapper><img class=file-icon ng-src={{getIcon(file)}}></div>{{file.name}}</a></td><td>{{file.size | formatSize}}</td><td><img ng-if=file.creationBy ng-src="{{file.deleteBy.avatar | resource}}" class=img-circle style=height:30px;float:left alt=...> <span class=m-l-xs>{{file.deleteBy.name}}</span></td><td>{{file.deleteDate}}</td><td>{{file.updateDate}}</td></tr></tbody></table></div><div ng-if="mode == \'block\'"><ul class=file-block-list><li class=file-block ng-class="{true:\'active\'}[file.selected]" ng-click=select(file,null,$event) ng-dblclick=open(file,$event); ng-repeat="file in files|orderBy:sortField:sortDesc | filter:{name:condition}"><img class=file-icon ng-src={{getIcon(file)}}><div class="file-name text-ellipsis m-t-sm" tooltip={{file.name}} tooltip-placement=bottom>{{file.name}}</div></li></ul></div><div class="wrapper-xl text-center" ng-show=loading><img ng-src="{{\'asset/img/loading.gif\' | resource}}"><p class=m-t-sm>正在加载</p></div><div class="wrapper-xl text-center" ng-show="(files.length == 0 || !files) && !loading"><img ng-src="{{\'asset/img/empty.png\' | resource}}"><p class=m-t-md>回收站中没有文件</p></div></div></div><div class="wrapper-xl text-center" ng-show=error><img ng-src="{{\'asset/img/error.png\' | resource}}"><p class=m-t-md>加载回收站失败：{{error}}</p></div>'),e.put("asset/tpl/search.html",'<div class=app-ctrl style="padding-top:90px;overflow: hidden;padding-bottom: 42px" ng-show=!error><div class="b-b app-title-fixed padder"><div class="row wrapper-xs b-b bg-light"><div class="col-sm-9 col-xs-9 padder-sm"><span class="m-n directory-header text-md"><i class="fa fa-search"></i> "{{keyword}}" - 搜索结果 </span><span class="text-sm m-l-xs" ng-show="files.length > 0">( <span ng-show="selection.length > 0">{{selection.length}} / </span>{{files.length}} )</span></div><div class="col-sm-3 col-xs-3 padder-sm hidden"><div class=pull-right><button class="btn btn-md btn-default" ng-click=switchMode()><i class=fa ng-class="{ true:\'fa-list\',false:\'fa-th\'}[mode == \'list\']"></i> <span ng-show="mode == \'list\'">列表视图</span> <span ng-show="mode == \'block\'">图标视图</span></button><div class=btn-group dropdown is-open=openSortmenu><button type=button class="btn btn-md btn-default" ng-click=changeDesc();><i ng-class="{\'fa-long-arrow-down\' : sortDesc,\'fa-long-arrow-up\':!sortDesc}" class=fa></i> <span ng-show="sortField == \'name\'">名称</span> <span ng-show="sortField == \'size\'">大小</span> <span ng-show="sortField == \'creationBy.name\'">创建者</span> <span ng-show="sortField == \'updateDate\'">时间</span></button> <button type=button btn-md class="btn btn-md btn-default dropdown-toggle" dropdown-toggle><span class=caret></span></button><ul class=dropdown-menu role=menu style="left: inherit; right: 0px"><li><a href ng-click="changeSort(\'name\')">名称</a></li><li><a href ng-click="changeSort(\'size\')">大小</a></li><li><a href ng-click="changeSort(\'creationBy.name\')">创建者</a></li><li><a href ng-click="changeSort(\'updateDate\')">时间</a></li></ul></div></div></div></div><div class="row wrapper-xs bg-light lter"><div class="col-sm-10 col-xs-10 padder-sm"><button class="btn btn-md btn-default" ng-click=open(selection[0],$event) ng-show="selection.length == 1 "><i class="glyphicon glyphicon-new-window"></i> 打开文件</button> <button class="btn btn-md btn-default" ng-click=openParent(selection[0],$event) ng-show="selection.length == 1 "><i class="fa fa-folder-open"></i> 打开所在文件夹</button> <button class="btn btn-md btn-default" ng-click=download() ng-show="selection.length > 0 "><i class="glyphicon glyphicon-cloud-download"></i> 下载</button></div><div class="col-sm-2 col-xs-2 text-right padder-sm"><div class="input-group-icon directory-search"><i class="glyphicon glyphicon-search input-icon"></i> <input ng-model=condition class="form-control input-sm rounded" placeholder=在结果中搜索></div></div></div></div><div class="bg-white app-inner"><ul class=search-result><li class="wrapper-sm b-b" ng-class="{true:\'active\'}[file.selected]" ng-repeat="file in result.result"><div class=search-item><label class="i-checks i-checks-sm m-b-none item-checker"><input type=checkbox ng-checked=file.selected ng-click=select(file,null,$event);><i></i></label><div class=item-head><div class=item-icon><img ng-src={{getIcon(file)}}></div><div ng-click=open(file,$event)><span class=item-name ng-bind-html="file.name | trustHtml"></span></div><ul class="item-meta clearfix"><li>{{file.createdBy}}</li><li>&nbsp;创建于 <span>{{file.createDate}}</span></li><li>&nbsp;{{file.size | formatSize}}</li></ul></div><div class=item-summary ng-bind-html="file.summary | trustHtml"></div><div class=item-path><a class=text-primary ng-click=openParent(file,$event) href>{{file.fullName}}</a></div></div></li></ul><div ng-if="mode == \'block\'"><ul class=file-block-list><li class=file-block ng-class="{true:\'active\'}[file.selected]" ng-click=select(file,null,$event) ng-dblclick=open(file,$event); ng-repeat="file in files|orderBy:sortField:sortDesc | filter:{name:condition}"><img class=file-icon ng-src={{getIcon(file)}}><div class="file-name text-ellipsis m-t-sm" tooltip={{file.name}} tooltip-placement=bottom>{{file.name}}</div></li></ul></div><div class="wrapper-xl text-center" ng-show=loading><img ng-src="{{\'asset/img/loading.gif\' | resource}}"><p class=m-t-sm>正在加载</p></div><div class="wrapper-xl text-center" ng-show="(result.result.length == 0 || !result.result) && !loading"><img ng-src="{{\'asset/img/empty.png\' | resource}}"><p class=m-t-md>没有搜索到与关键词匹配的文件</p></div></div><div class="pos-abt w-full b-t" style=bottom:0px ng-show="!error && result.total > 0 && !loading"><div class="col-sm-6 wrapper-xs"><button class="btn btn-sm btn-link" ng-click=loadPage(1) ng-disabled="pagination.page == 1"><i class="fa fa-fast-backward"></i></button> <button class="btn btn-sm btn-link" ng-click="loadPage(pagination.page - 1)" ng-disabled="pagination.page == 1"><i class="fa fa-backward"></i></button> <input class="inline form-control input-sm" style="width: 30px" ng-model-options="{ updateOn: \'blur\' }" ng-change=onPageChange(); ng-model=pagination.page> / <span>{{pagination.pages}}</span> <button class="btn btn-sm btn-link" ng-click="loadPage(pagination.page + 1)" ng-disabled="pagination.page == pagination.pages"><i class="fa fa-forward"></i></button> <button class="btn btn-sm btn-link" ng-click=loadPage(pagination.pages) ng-disabled="pagination.page == pagination.pages"><i class="fa fa-fast-forward"></i></button></div><div class="col-sm-6 wrapper-xs text-right"><div style="line-height: 30px">共{{result.total}}条数据，每页显示<select class="form-control input-sm inline" style=width:65px ng-change=reload() ng-model=pagination.size><option value=20>20</option><option value=50>50</option><option value=100>100</option><option value=200>200</option></select>条</div></div><div class=clearfix></div></div></div><div class="wrapper-xl text-center" ng-show=error><img ng-src="{{\'asset/img/error.png\' | resource}}"><p class=m-t-md>搜索文件失败：{{error}}</p></div>'),e.put("asset/tpl/share.html",'<div class=m-c><div class=modal-header><button type=button class=close ng-click=close();><span aria-hidden=true>×</span></button><h4 class=modal-title style="line-height: 34px"><i class="fa fa-share-alt"></i> 分享文件</h4></div><div class=modal-body><div class=row><div class=col-sm-12><form name=shareForm class="form-horizontal form-validation"><div class=form-group><label class="col-sm-2 control-label" style=padding-left:5px;padding-right:5px>分享链接：</label><div class=col-sm-10><div class=input-group><span class=input-group-addon><i class="fa fa-link"></i></span><textarea type=text name=link id=shareLink ng-model=link class=form-control readonly></textarea><span class=input-group-btn></span></div></div></div><div class=form-group><label class="col-sm-2 control-label" style=padding-left:5px;padding-right:5px>访问密码：</label><div class=col-sm-10><div class=input-group><span class=input-group-addon><i class="glyphicon glyphicon-lock"></i></span> <input name=code ng-model=share.password class=form-control></div></div></div><div class=form-group><label class="col-sm-2 control-label" style=padding-left:5px;padding-right:5px>到期时间：</label><div class=col-sm-10><div class=input-group><span class=input-group-addon><i class="fa fa-calendar"></i></span> <input class=form-control ng-click="opened = true" date-format=YYYY-MM-DD ng-model=share.dueDate datepicker-popup=yyyy-MM-dd is-open=opened datepicker-options="{formatYear: \'yyyy\',class:\'datepicker\',showWeeks:false}" close-text=关闭 current-text=今天 clear-text=清除></div></div></div><div class="alert alert-warning m-b-none"><p style="text-indent: 2em"><b>说明：</b>分享个人文档任何用户可以通过密码（如果有设置）进行访问，分享企业文档除密码之外（如果有设置）必须用户拥有权限才能访问。</p></div></form></div></div></div><div class=modal-footer><button type=button class="btn btn-primary" ng-click=update() ng-disabled="!shareForm.$dirty || saving"><span ng-show=!saving>提交</span> <span ng-show=saving>正在提交...</span></button> <button type=button class="btn btn-primary" ng-click=remove() ng-disabled="deleting || !share"><span ng-show=!deleting>删除分享</span> <span ng-show=deleting>正在删除...</span></button> <button class="btn btn-default" type=button ng-click=copy();><i class="fa fa-copy"></i> 复制链接</button> <button type=button class="btn btn-default" ng-click=close()>关闭</button></div></div>'),e.put("asset/tpl/shares.html",'<div class=app-ctrl style="padding-top:90px;overflow: hidden" ng-show=!error><div class="b-b app-title-fixed padder"><div class="row wrapper-xs b-b bg-light"><div class="col-sm-9 col-xs-9 padder-sm"><span class="m-n directory-header text-md"><i class="fa fa-share-alt"></i> 我的分享</span></div><div class="col-sm-3 col-xs-3 padder-sm"><div class=pull-right><div class=btn-group dropdown is-open=openSortmenu><button type=button class="btn btn-md btn-default" ng-click=changeDesc();><i ng-class="{\'fa-long-arrow-down\' : sortDesc,\'fa-long-arrow-up\':!sortDesc}" class=fa></i> <span ng-show="sortField == \'name\'">名称</span> <span ng-show="sortField == \'shareDate\'">分享时间</span> <span ng-show="sortField == \'dueDate\'">到期时间</span> <span ng-show="sortField == \'visits\'">访问次数</span> <span ng-show="sortField == \'status\'">状态</span></button> <button type=button class="btn btn-md btn-default dropdown-toggle" dropdown-toggle><span class=caret></span></button><ul class=dropdown-menu role=menu style="left: inherit; right: 0px"><li><a href ng-click="changeSort(\'name\')">名称</a></li><li><a href ng-click="changeSort(\'shareDate\')">分享时间</a></li><li><a href ng-click="changeSort(\'dueDate\')">到期时间</a></li><li><a href ng-click="changeSort(\'visits\')">访问次数</a></li><li><a href ng-click="changeSort(\'status\')">状态</a></li></ul></div></div></div></div><div class="row wrapper-xs bg-light lter"><div class="col-sm-10 col-xs-10 padder-sm"><button class="btn btn-md btn-default" ng-click=openParent(selection[0],$event) ng-show="selection.length == 1 && selection[0].type != \'directory\'"><i class="glyphicon glyphicon-new-window"></i> 打开所在文件夹</button> <button class="btn btn-md btn-default" ng-click=open(selection[0],$event) ng-show="selection.length == 1 && selection[0].type == \'directory\'"><i class="fa fa-folder-open"></i> 打开文件夹</button> <button class="btn btn-md btn-default" ng-click=remove() ng-show="selection.length > 0"><i class="fa fa-trash"></i> 删除分享</button></div><div class="col-sm-2 col-xs-2 text-right padder-sm"><div class="input-group-icon directory-search"><i class="glyphicon glyphicon-search input-icon"></i> <input ng-model=condition class="form-control input-sm rounded" placeholder=\'搜索"我的分享"\'></div></div></div></div><div class="bg-light lter app-inner" ng-click=onContainerClick();><div class="table-responsive file-list" ng-if="mode== \'list\'" ng-show="shares.length > 0 && !loading"><table class="table b-b b-light lter file-table"><thead><tr><th width=5%><label class="i-checks i-checks-sm m-b-none" ng-show=!condition><input type=checkbox ng-click=selecteAll() ng-checked=isSelectAll><i></i></label></th><th ng-click="changeSort(\'name\')" width=30%>名称 <i ng-show="sortField == \'name\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'shareDate\')" width=15%>分享时间 <i ng-show="sortField == \'shareDate\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'dueDate\')" width=15%>到期时间 <i ng-show="sortField == \'dueDate\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'visits\')" width=10%>访问次数 <i ng-show="sortField == \'visits\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th ng-click="changeSort(\'status\')" width=10%>状态 <i ng-show="sortField == \'status\'" ng-class="{\'fa-caret-up\' : !sortDesc,\'fa-caret-down\':sortDesc}" class=fa></i></th><th width=20%>备注</th></tr></thead><tbody><tr ng-repeat="file in shares|orderBy:sortFields:sortDesc | filter:{name:condition}" class="file-item hc-item" ng-class="{true:\'active\'}[file.selected]" valign=middle ng-click=select(file)><td width=5%><label class="i-checks i-checks-sm m-b-none"><input type=checkbox ng-checked=file.selected ng-click=select(file);><i></i></label></td><td class=text-ellipsis><a ng-click=open(file,$event); ng-class="{\'text-muted\':file.status == 1}"><div class=file-icon-wrapper><img class=file-icon ng-src={{getIcon(file)}}></div>{{file.name}}</a></td><td>{{file.shareDate}}</td><td>{{file.dueDate}}</td><td>{{file.visits}}</td><td>{{file.status | translate:\'share.status\'}}</td><td>{{file.note}}</td></tr></tbody></table></div><div class="wrapper-xl text-center" ng-show=loading><img ng-src="{{\'asset/img/loading.gif\' | resource}}"><p class=m-t-sm>正在加载</p></div><div class="wrapper-xl text-center" ng-show="(shares.length == 0 || !files) && !loading"><img ng-src="{{\'asset/img/empty.png\' | resource}}"><p class=m-t-md>您还没有分享文件</p></div></div></div><div class="wrapper-xl text-center" ng-show=error><img ng-src="{{\'asset/img/error.png\' | resource}}"><p class=m-t-md>加载我的分享失败：{{error}}</p></div>'),e.put("asset/tpl/tags.html",'<div class=m-c><div class=modal-header><h4 class=modal-title><i class="fa fa-tags"></i> 设置标签 <button type=button class=close ng-click=cancel();>×</button></h4></div><div class="modal-body no-padder"><div class="wrapper-md clearfix" ng-show="tags.length > 0"><div class="i-tag i-tag-close" ng-repeat="tag in tags track by $index"><span>{{tag}}</span> <a href=javascript:void(0); class=close ng-click=remove(tag)>×</a></div></div><div class="wrapper-md text-center" ng-show="tags.length == 0">没有设置标签</div><div class="wrapper-md b-t"><form name=tagForm class="form-horizontal form-validation"><div class=input-group><span class=input-group-addon>添加标签</span> <input class=form-control ng-model=tag placeholder=标签长度200个字内><div class=input-group-btn><button type=button class="btn btn-default" ng-diabled=tag ng-click=add();><i class="glyphicon glyphicon-ok"></i></button></div></div></form></div></div></div>')}]);